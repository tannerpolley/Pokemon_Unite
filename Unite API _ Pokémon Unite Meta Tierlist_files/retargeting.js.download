(()=>{"use strict";let e,t,o,n;function i(e,t={}){const o={...t};return o.headers={...o.headers,"Anon-App-Version":"0.3.25a"},fetch(e,o)}!function(e){e.IdwHydraHasErrorKey="IDW_HYDRA_HAS_ERROR",e.IdwCohortIdsKey="cohort_ids",e.idwScrollY="idw-scroll-y",e.IdwImpressionsKey="idw-impressions",e.anonymised="Anonymised",e.isOofUrl="idw-oof",e.idwOutdated="idw-outdated"}(e||(e={})),function(e){e.Quantcast="quantcast",e.Consentmanager="consentmanager",e.Liveramp="liveramp",e.Clickio="clickio",e.Sourcepoint="sourcepoint",e.Iubenda="iubenda",e.Uniconsent="uniconsent",e.OneTrust="onetrust",e.CookiePro="cookiepro",e.CookieBot="cookiebot",e.Googlefc="googlefc",e.Admiral="admiral",e.Ensighten="ensighten",e.CookieScript="cookiescript",e.Klaro="klaro"}(t||(t={})),function(e){e.colorPrimary="idw_color_primary",e.errorReportingLevel="idw_error_reporting_level",e.cmpProvider="idw_cmp_provider",e.cmpProviderCookieGroup="idw_cmp_provider_cookie_group",e.environment="idw_environment",e.notIntegrateCmp="idw_not_integrate_cmp",e.overrideHasConsent="override_has_consent",e.softPrivacyRegulated="soft_privacy_regulated",e.hideButton="idw_hide_button",e.notLoginUser="not_login_user",e.retargetingOn="retargeting_on",e.gptTargetingOn="gpt_targeting_on",e.extendLoginToSubdomains="extend_login_to_subdomains",e.clientId="idw_client_id",e.cohortPollingInterval="idw_cohort_polling_interval",e.loginExceptionPages="idw_login_exception_pages",e.loginInclusionPages="idw_login_inclusion_pages",e.immediateLoginPages="idw_immediate_login_pages",e.metricsRootUrl="idw_metrics_root_url",e.metricsCollectorUrl="idw_metrics_collector_url",e.retargetingScriptUrl="idw_retargeting_script_url",e.retargetingSegmentsUrl="idw_retargeting_segments_url",e.healthCheckUrl="idw_health_check_url",e.errorReportingUrl="idw_error_reporting_url",e.authority="idw_authority"}(o||(o={})),function(e){e.colorPrimary="color-primary",e.errorReportingLevel="error-reporting-level",e.cmpProvider="cmp-provider",e.cmpProviderCookieGroup="cmp-provider-cookie-group",e.environment="environment",e.notIntegrateCmp="not-integrate-cmp",e.overrideHasConsent="override-has-consent",e.softPrivacyRegulated="soft-privacy-regulated",e.hideButton="hide-button",e.notLoginUser="not-login-user",e.retargetingOn="retargeting-on",e.gptTargetingOn="gpt-targeting-on",e.extendLoginToSubdomains="extend-login-to-subdomains",e.clientId="client-id",e.cohortPollingInterval="cohort-polling-interval",e.loginExceptionPages="login-exception-pages",e.loginInclusionPages="login-inclusion-pages",e.immediateLoginPages="immediate-login-pages",e.loginInNewTab="login-in-new-tab",e.metricsRootUrl="metrics-root-url",e.metricsCollectorUrl="metrics-collector-url",e.retargetingScriptUrl="retargeting-script-url",e.retargetingSegmentsUrl="retargeting-segments-url",e.healthCheckUrl="health-check-url",e.errorReportingUrl="error-reporting-url",e.authority="authority"}(n||(n={}));({maxScrollPosition:0,getMaxScroll:function(){return Math.round(this.maxScrollPosition)},updateMaxScroll:function(){const e=function(){const e=document.documentElement,t=document.body,o="scrollTop",n="scrollHeight";return(e[o]||t[o])/((e[n]||t[n])-e.clientHeight)*100||0}();e>this.maxScrollPosition&&(this.maxScrollPosition=e)},subscribeToScrollEvent:function(){window.addEventListener("scroll",(()=>{this.updateMaxScroll()}))}}).subscribeToScrollEvent();const r="AnonRetargeting:",s="unsent-segments";let l=null;const c=document.currentScript;async function a(t){const o=c.getAttribute("idw_metrics_url");if(!o)return void console.warn(`${r} required script attribute idw_metrics_url is not defined!`);const n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+l?.access_token},body:JSON.stringify({tag:t.uid}),keepalive:!0},{ok:s}=await i(o,n);if(s&&"published"===t.status)try{const o=new Set(JSON.parse(localStorage.getItem(e.IdwCohortIdsKey))??[]);o.add(t.uid),localStorage.setItem(e.IdwCohortIdsKey,JSON.stringify(Array.from(o)))}catch(e){console.warn(`${r} segment assigned, but failed to update segment id in local storage:`,e)}}function d(){return new Set(JSON.parse(sessionStorage.getItem(s))??[])}async function g(){const e=c.getAttribute(n.retargetingSegmentsUrl);if(!e)return void console.warn(`${r} required script attribute ${n.retargetingSegmentsUrl} is not defined!`);const t=c.getAttribute("idw_authority"),o=Object.entries(localStorage).find((([e,o])=>e.startsWith(`oidc.user:${t}`)));if(l=o?JSON.parse(o[1]):null,function(e){return!e||e?.expires_at&&Math.round((new Date).getTime()/1e3)>=e.expires_at}(l))return void console.warn(`${r} auth token expired. Retargeting will start after OOF`);const g=d();g.forEach((async e=>{const t={uid:e};await a(t),g.delete(e),0===g.size?sessionStorage.removeItem(s):sessionStorage.setItem(s,JSON.stringify(Array.from(g)))}));const m=(await async function(e){const t={headers:{"Content-Type":"application/json",Authorization:"Bearer "+l.access_token}};try{const o=await i(e,t);if(!o.ok)throw new Error(`Failed to fetch segment definitions. Status: ${o.status}`);return await o.json()}catch(e){return console.warn(e),[]}}(e)).filter((e=>{return null===(t=e.definition).pages||0===t.pages.length||t.pages.some((e=>"contains"===e.condition.value?window.location.href.includes(e.value):function(e,t){const o=e=>e.replace(/^[^:]+:\/\/+/,"").replace(/\/$/,"").replace(/^www\./,"");return e===t||o(e)===o(t)}(window.location.href,e.value)));var t}));console.log(`${r} found ${m?.length??0} segment definitions for current page`),m.forEach((e=>{e.definition?.properties?.length>0?e.definition.properties.forEach((t=>{try{if("slotClicked"===t.event.value){const o=t.condition.value,n=t.value.toString();console.log(`${r} slotClicked '${o}=${n}' condition`);const i=new Set;window.googletag.cmd.push((function(){window.googletag.pubads().getSlots().forEach((t=>{const s=t.getSlotElementId(),l=document.getElementById(s);l&&!i.has(s)&&(l.addEventListener("click",(function(){const i=t.getResponseInformation();if(i){console.log(`${r} rs slotClicked event: ${o}:${i[o]}, val ${n}`);const t=i[o]?.toString();t===n&&a(e)}})),i.add(s))})),window.googletag.pubads().addEventListener("slotRenderEnded",(function(t){if(!t.isEmpty){const s=t.slot.getSlotElementId(),l=document.getElementById(s);l&&!i.has(s)&&(l.addEventListener("click",(function(){console.log(`${r} slotClicked event: ${o}:${t[o]}`),t[o]?.toString()===n&&a(e)})),i.add(s))}}))}))}else if("slotViewed"===t.event.value){const o=t.condition.value,n=t.value.toString();console.log(`${r} slotViewed '${o}=${n}' condition`),window.googletag.cmd.push((function(){window.googletag.pubads().getSlots().forEach((t=>{const i=t.getResponseInformation();if(i){const s=t.getSlotElementId();if(function(e){if(!e||!e.getBoundingClientRect)return!1;const t=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return t.top>=0&&t.left>=0&&t.bottom<=o&&t.right<=n}(document.getElementById(s))){console.log(`${r} rs slotViewed event: ${o}:${i[o]}, val ${n}`);const t=i[o]?.toString();t===n&&a(e)}}})),window.googletag.pubads().addEventListener("impressionViewable",(function(t){console.log(`${r} slotViewed event: ${o}:${t[o]}`),t[o]?.toString()===n&&a(e)}))}))}else if("dataLayer"===t.event.value){const o=t.condition.value,n=t.value;console.log(`${r} dataLayer '${o}=${n}' condition`),Object.values(window.dataLayer).some((e=>e[o]===n))&&a(e)}else{console.log(`${r} selector ${t.value}, condition ${t.condition.value}`);const o="id"===t.condition.value?u(t.value)?[u(t.value)]:[]:function(e){const t=Array.from(document.querySelectorAll(e));if(t.length)return t;const o=Array.from(document.querySelectorAll("iframe"));for(const n of o)try{n?.contentDocument?.querySelectorAll&&t.push(...Array.from(n.contentDocument.querySelectorAll(e)))}catch(t){console.warn(`${r} failed to query selector ${e} in iframe ${n.src}:`,t?.message)}return t}(t.value);console.log(`${r} found ${o?.length??0} elements to subscribe to ${t.event.value} event. Segment definition ${e?.uid}`),o.forEach((o=>{o.addEventListener(t.event.value,(()=>{const t=d();t.add(e.uid),sessionStorage.setItem(s,JSON.stringify(Array.from(t))),a(e).then((()=>{const t=d();t.delete(e.uid),sessionStorage.setItem(s,JSON.stringify(Array.from(t)))}))}))}))}}catch(t){return void console.warn(`${r} failed parsing segment definition ${e.uid}:`,t?.message)}})):e.definition&&(console.log(`${r} Segment 'properties' blank. Assign user by the page view. Segment definition ${e.uid}`),a(e))}))}function u(e){const t=document.getElementById(e);if(t)return t;const o=Array.from(document.querySelectorAll("iframe"));for(const t of o)try{if(t?.contentDocument?.getElementById){const o=t.contentDocument.getElementById(e);if(o)return o}}catch(o){console.warn(`${r} failed to get element by id ${e} in iframe ${t.src}:`,o?.message)}return null}function m(){setTimeout((()=>{g()}),1e3)}"complete"===document.readyState||"interactive"===document.readyState?m():document.addEventListener("DOMContentLoaded",(()=>{m()}))})();