(()=>{var e={122:(e,t,i)=>{"use strict";function n(e){var t;t=e.idwServicesConf.idwDataAccountWebUrl,window.open(t,"_blank").focus()}i.r(t),i.d(t,{app:()=>ge});var r=i(57),s=i(384),o=i(65),a=i.n(o);class c{constructor(){var e;(e="tcDataValue")in this?Object.defineProperty(this,e,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[e]=null}hasConsent(){try{if(r.qQ.overrideHasConsent)return!0;if(!window.__tcfapi&&r.qQ.softPrivacyRegulated)return!0;if(!this.tcDataValue)return a().warn("Not yet received TCData from TCF API addEventListener"),!1;if(!1===this.tcDataValue.gdprApplies)return!0;const e=!!this.tcDataValue?.vendor?.consents[1116];return a().debug("Anonymised IAB vendor (ID 1116) consent:",e),e}catch(e){return a().warn(e),!1}}onConsentChanged(e){window.__tcfapi?window.__tcfapi("addEventListener",2,((t,i)=>{"cmpuishown"===t.eventStatus&&this.tcDataValue||(i?(a().debug(`tcf event: ${t.eventStatus}`,t),this.tcDataValue=t,e()):a().warn("__tcfapi.addEventListener failed with error. tcData: ",t))})):r.qQ.overrideHasConsent||r.qQ.softPrivacyRegulated?e():a().warn("__tcfapi is not defined")}}class d extends c{displayCMP(){window.__tcfapi("displayConsentUi",2,(()=>{}))}}class l extends c{displayCMP(){if(window.__cmp)try{window.__cmp("showScreen")}catch(e){a().warn("Consentmanager API error:",e)}else a().warn("Consentmanager API(window.__cmp) is not available. Can not invoke showScreen")}}class u extends c{displayCMP(){window.__tcfapi("toggleConsentTool",2,(()=>{}))}}class h extends c{displayCMP(){if(window.__lxG__consent__&&window.__lxG__consent__.showConsent)try{window.__lxG__consent__.showConsent()}catch(e){a().warn("Clickio API error:",e)}else a().warn("Clickio API(window.__lxG__consent__) is not available. Can not invoke displayCMP")}}class g extends c{constructor(e){var t;super(),(t="privacyManagerId")in this?Object.defineProperty(this,t,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[t]=null,this.privacyManagerId=e}displayCMP(){const e=window._sp_?.gdpr?.loadPrivacyManagerModal||window._sp_?.loadPrivacyManagerModal;if(e)try{this.privacyManagerId?e(this.privacyManagerId):e()}catch(e){a().warn("Sourcepoint API error:",e)}else a().warn("Sourcepoint API error: loadPrivacyManagerModal() function is not defined")}}class p extends c{displayCMP(){if(window.__unicapi)try{window.__unicapi("openunic")}catch(e){a().warn("UniConsent API error:",e)}else a().warn("UniConsent API(window.__unicapi) is not available")}}class w extends c{displayCMP(){if(window.Cookiebot&&window.Cookiebot.show)try{window.Cookiebot.show()}catch(e){a().warn("Cookiebot API error:",e)}else a().warn("Cookiebot API(window.Cookiebot) is not available. Can not invoke displayCMP")}}class m extends c{displayCMP(){a().warn(`attempt to call displayCMP. This should not happened when ${s.tF.cmpProvider} attribute is not set`)}}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class _ extends c{constructor(e){super(),f(this,"cookieGroup",null),f(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window._iub&&window._iub.cs&&window._iub.cs.api&&window._iub.cs.api.openPreferences)try{window._iub.cs.api.openPreferences()}catch(e){a().warn("Iubenda API error:",e)}else a().warn("Iubenda API(window._iub.cs.api.openPreferences()) is not available. Can not invoke function")}hasConsent(){return this.useTcfApi?super.hasConsent():window._iub?.cs?.consent?.purposes[this.cookieGroup]}onConsentChanged(e){if(this.useTcfApi)super.onConsentChanged(e);else{let t=this.hasConsent();window._iub?setInterval((()=>{const i=this.hasConsent();t!==i&&(t=i,e())}),1e3):a().warn("Iubenda API(window._iub) is not available"),e()}}}function v(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class y extends c{constructor(e){super(),v(this,"cookieGroup",null),v(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window.OneTrust&&window.OneTrust.ToggleInfoDisplay)try{window.OneTrust.ToggleInfoDisplay()}catch(e){a().warn("OneTrust API error:",e)}else a().warn("OneTrust API(window.OneTrust.ToggleInfoDisplay) is not available. Can not invoke ToggleInfoDisplay")}hasConsent(){return this.useTcfApi?super.hasConsent():window.OptanonActiveGroups&&window.OptanonActiveGroups.toLocaleLowerCase().includes(this.cookieGroup.toLocaleLowerCase())}onConsentChanged(e){this.useTcfApi?super.onConsentChanged(e):(window.OneTrust&&window.OneTrust.OnConsentChanged?window.OneTrust.OnConsentChanged((function(){e()})):a().warn("OneTrust API(window.OneTrust.OnConsentChanged) is not available. Can not invoke OnConsentChanged"),e())}}class b extends c{displayCMP(){if(window.googlefc&&window.googlefc.showRevocationMessage)try{window.googlefc.showRevocationMessage()}catch(e){a().warn("Google Funding Choices API error:",e)}else a().warn("Google Funding Choices API is not available. Can not invoke googlefc.showRevocationMessage()")}}class S extends c{displayCMP(){if(window.admiral)try{window.admiral("show","cmp.settings")}catch(e){a().warn("Admiral API error:",e)}else a().warn('Admiral API(window.admiral("show", "cmp.settings")) is not available. Can not invoke displayCMP')}}function C(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class k extends c{constructor(e){super(),C(this,"cookieGroup",null),C(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window.Bootstrapper&&window.Bootstrapper.gateway&&window.Bootstrapper.gateway.openBanner)try{window.Bootstrapper.gateway.openBanner()}catch(e){a().warn("Ensighten API error:",e)}else a().warn("Ensighten API(window.Bootstrapper.gateway.openBanner()) is not available. Can not invoke function")}checkConsent(){if(window?.Bootstrapper?.gateway?.getUserPreference("Advertisement")>0)return!0;if(!window?.Bootstrapper?.gateway?.getList)return a().warn("Ensighten API(window.Bootstrapper.gateway.getList()) is not available. Can not invoke function"),!1;try{const e=window.Bootstrapper.gateway.getList();return e.CUSTOM_ALLOW&&e.CUSTOM_ALLOW.some((e=>e.tag.includes("https://account.anonymised.io/login")))||e.CUSTOM_BLOCK&&!e.CUSTOM_BLOCK.some((e=>e.tag.includes("https://account.anonymised.io/login")))}catch(e){return a().warn("Ensighten API error:",e),!1}}hasConsent(){return this.useTcfApi?super.hasConsent():this.checkConsent()}onConsentChanged(e){if(this.useTcfApi)super.onConsentChanged(e);else{let t=this.hasConsent();window.Bootstrapper?setInterval((()=>{const i=this.hasConsent();t!==i&&(t=i,e())}),1e3):a().warn("Ensighten API(window.Bootstrapper) is not available"),e()}}}function I(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class T extends c{constructor(e){super(),I(this,"cookieGroup",null),I(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window.CookieScript?.instance?.show)try{window.CookieScript.instance.show()}catch(e){a().warn("CookieScript API error:",e)}else a().warn("CookieScript API(window.CookieScript) is not available. Can not invoke displayCMP")}hasConsent(){if(this.useTcfApi)return super.hasConsent();{const e=window.CookieScript?.instance?.currentState();return"accept"===e?.action&&e.categories?.includes(this.cookieGroup.toLocaleLowerCase())}}onConsentChanged(e){if(this.useTcfApi)super.onConsentChanged(e);else{let t=null;const i=()=>{null!==t&&clearTimeout(t),t=window.setTimeout((()=>{e(),t=null}),100)};window.addEventListener("CookieScriptAcceptAll",i),window.addEventListener("CookieScriptAccept",i),window.addEventListener("CookieScriptReject",i),e()}}}function P(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class E extends c{constructor(e){super(),P(this,"cookieGroup",null),P(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window.klaro?.show)try{window.klaro.show()}catch(e){a().warn("Klaro API error:",e)}else a().warn("Klaro API(window.klaro) is not available. Can not invoke displayCMP")}hasConsent(){return this.useTcfApi?super.hasConsent():window.klaro?.getManager().getConsent(this.cookieGroup.toLocaleLowerCase())}onConsentChanged(e){if(this.useTcfApi)super.onConsentChanged(e);else{const t={update:function(t,i){"saveConsents"===i&&e()}};window.klaro.getManager().watch(t),e()}}}let x=null;const[R,O]=r.qQ.cmpProvider?r.qQ.cmpProvider.split(":"):["undefined",null],A=O?.trim()||null,U=r.qQ.cmpProviderCookieGroup;switch(a().debug(`cmpProvider: ${R}, privacyManagerId: ${A}, cmpProviderCookieGroup: ${U}`),R.toLowerCase()){case s.P_.Quantcast:a().debug("using QuantcastApi"),x=new d;break;case s.P_.Consentmanager:a().debug("using ConsentmanagerApi"),x=new l;break;case s.P_.Liveramp:a().debug("using LiverampApi"),x=new u;break;case s.P_.Clickio:a().debug("using ClickioApi"),x=new h;break;case s.P_.Sourcepoint:a().debug("using SourcepointApi"),x=new g(A);break;case s.P_.Iubenda:a().debug("using Iubenda"),x=new _(U);break;case s.P_.Uniconsent:a().debug("using UniConsentApi"),x=new p;break;case s.P_.OneTrust:case s.P_.CookiePro:a().debug("using OneTrustApi"),x=new y(U);break;case s.P_.CookieBot:a().debug("using Cookiebot"),x=new w;break;case s.P_.Googlefc:a().debug("using GooglefcApi"),x=new b;break;case s.P_.Admiral:a().debug("using AdmiralApi"),x=new S;break;case s.P_.Ensighten:a().debug("using EnsightenApi"),x=new k;break;case s.P_.CookieScript:a().debug("using CookieScriptApi"),x=new T(U);break;case s.P_.Klaro:a().debug("using KlaroApi"),x=new E(U);break;default:a().warn(`Unset or used incorrect value of the ${s.tF.cmpProvider}:'${r.qQ.cmpProvider}'. \n        The default TCFv2 API will be used`),x=new m}class L{constructor(e){var t,i;i=void 0,(t="pluginConfig")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.pluginConfig=e}addPluginButtonToDOM(){if(this.pluginConfig.hideButton)return;const e=document.createDocumentFragment(),t=document.createElement("div");t.innerHTML=`<div id='idw-open-trigger'\n        style='display:none' ${this.pluginConfig.notIntegrateCmp?"title='Click to manage your data'":"title=''"}>\n        <img src="https://storage.googleapis.com/idw_static_assets/anonymized_small_black.png" loading="lazy" alt="Anonymised">\n      </div>`,e.appendChild(t.firstChild),document.body.appendChild(document.adoptNode(e)),document.getElementById("idw-open-trigger").addEventListener("click",this.handlePluginButtonClick.bind(this),!1)}addPluginToDOM(){if(this.pluginConfig.hideButton)return;const e=document.createDocumentFragment(),t=document.createElement("div");t.innerHTML="<div id='idw-plugin-container'>\n        <div id='idw-plugin-buttons'>\n        </div>\n      </div>",e.appendChild(t.firstChild),document.body.appendChild(e)}handlePluginButtonClick(){this.pluginConfig.notIntegrateCmp||x instanceof m||this.pluginConfig.softPrivacyRegulated&&!window.__tcfapi?n(this.pluginConfig):this.togglePlugin()}togglePlugin(){document.getElementById("idw-plugin-container").classList.contains("idw-open")?"hidden"!==document.body.style.overflow&&this.closePlugin():this.openPlugin()}closeOnClickOutside(){document.addEventListener("click",function(e){const t=document.getElementById("idw-open-trigger"),i=t?.contains(e.target);i||this.closePlugin()}.bind(this))}closePlugin(){document.getElementById("idw-plugin-container").classList.remove("idw-open")}openPlugin(){document.getElementById("idw-plugin-container").classList.add("idw-open")}shouldHidePluginButton(e){const t=document.getElementById("idw-open-trigger");t&&t.style&&(t.style.display=e?"none":"block")}navigateToScreenLoggedInMain(){this.pluginConfig.hideButton||(document.getElementById("idw-plugin-buttons").innerHTML="<button class='pluginBtn' id='idw-manage-consent' \n          style='display: block; border-bottom: 1px solid black'>Manage Your Data</button>\n          <button class='pluginBtn' id='idw-cookies-setting' \n          style=\"display: block\">Cookie Settings</button>",document.getElementById("idw-cookies-setting").addEventListener("click",(()=>{x.displayCMP(),this.closePlugin()})),document.getElementById("idw-manage-consent").addEventListener("click",(()=>{n(this.pluginConfig),this.closePlugin()})),this.closeOnClickOutside())}addStyle(e){const t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}injectCustomCSSOverrides(){this.addStyle(`\n      #idw-plugin-container .pluginBtn {\n            color: ${this.pluginConfig.colorPrimary} !important;\n        }\n\n        #idw-plugin-container .pluginBtn:hover {\n            background-color: ${this.pluginConfig.colorPrimary} !important;\n        }\n                \n        #idw-open-trigger {\n            background-color: ${this.pluginConfig.colorPrimary};\n        }\n    `)}}const M=async function(e){e.retargetingOn&&await function(e,t={}){return new Promise((i=>{if(function(e){return!!document.querySelector(`script[src='${e}']`)}(e))return void i();const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.addEventListener("load",(()=>{i()})),n.src=e,Object.keys(t).forEach((e=>{n.setAttribute(e,t[e])})),document.getElementsByTagName("head")[0].appendChild(n)}))}(e.idwServicesConf.idwRetargetingScript,{idw_authority:e.oidcConf.authority,[s.tF.retargetingSegmentsUrl]:e.idwServicesConf.idwRetargetingSegmentsUrl,idw_metrics_url:`${e.idwServicesConf.idwMetricsRootUrl}/v3/collect/tag`})},N=function(e){!function(e){const t=document.querySelector(`script[src='${e}']`);t&&t.parentNode.removeChild(t)}(e.idwServicesConf.idwRetargetingScript)};var q=i(274),j=i(625),B=i(241);function F(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const H=new class{constructor(){F(this,"authorizationUrl",void 0),F(this,"codeVerifier",void 0),F(this,"postMessageTimeout",1e4),F(this,"client",void 0)}async buildAuthUrl(e){try{const t=await e.getUser();t&&!t.expired||(this.client=new j.hz({...r.qQ.oidcConf,metadata:{...r.qQ.oidcConf.metadata,authorization_endpoint:`${r.qQ.oidcConf.metadata.issuer}/experiment/no-oof-poc/auth`}}),this.authorizationUrl=await this.client.createSigninRequest({}))}catch(e){a().warn(`New tab auth error: cannot generate auth URL ${e}`)}}newAuthTabOpen(){if(this.authorizationUrl?.url){const e=window.open(this.authorizationUrl.url,"_blank");return a().debug("new tab opened:",!!e),e&&window.focus(),e}return null}subscribePostMessagePopup(){return new Promise((e=>{if(this.authorizationUrl){const t=setTimeout((()=>{a().warn(`New tab auth error: new tab message was not sent during ${this.postMessageTimeout} ms`),e(null)}),this.postMessageTimeout);a().debug("will subscribe to `get-redirect-url` message"),window.addEventListener("message",(async i=>{if("get-redirect-url"===i.data?.type){clearTimeout(t);try{e(await this.client.processSigninResponse(i.data.url))}catch(t){a().warn(`New tab auth error: ${t}`),e(null)}}}),!1)}else e(null)}))}};var $=i(123);class W{static detectDevice(){if(navigator.userAgentData?.mobile)return"mobile";const e=[this.checkUserAgent,this.checkScreenSize,this.checkTouchPoints,this.checkOrientation];return e.filter((e=>e())).length>=Math.ceil(e.length/2)?"mobile":"desktop"}static checkUserAgent(){const e=navigator.userAgent.toLowerCase();return["android","iphone","ipad","ipod","blackberry","windows phone","opera mini","mobile","tablet","mobi"].some((t=>e.includes(t)))}static checkScreenSize(){return window.innerWidth<=768}static checkTouchPoints(){return navigator.maxTouchPoints>1}static checkOrientation(){return window.innerHeight>window.innerWidth}static detectBrowser(){const e=navigator.userAgent.toLowerCase();return e.includes("chrome")&&!e.includes("edg")&&!e.includes("opr")||e.includes("crios")?"chrome":e.includes("edg")||e.includes("edge")?"edge":e.includes("firefox")||e.includes("fxios")?"firefox":!e.includes("safari")||e.includes("chrome")||e.includes("crios")||e.includes("fxios")||e.includes("edg")||e.includes("edge")?e.includes("opr")||e.includes("opera")||e.includes("opera mini")?"opera":e.includes("trident")||e.includes("msie")?"ie":"other":"safari"}}function D(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class z extends B.g{constructor(e){super(e),D(this,"loginInNewTabResultPromise",void 0),D(this,"events",["click","touchend","mouseup"]),D(this,"eventsSubscribed",!1),D(this,"isMobile",void 0),D(this,"isChrome",void 0),D(this,"handleClick",(e=>{const t=e.target,i=t?.closest("a");i||this.tryLogin()})),H.buildAuthUrl(this.userManager),this.isMobile="mobile"===W.detectDevice(),this.isChrome="chrome"===W.detectBrowser()}async queueLogin(){this.pluginConfig.notLoginUser||await this.tryLogin()}async tryLogin(){this.loginInNewTabResultPromise=H.subscribePostMessagePopup(),H.newAuthTabOpen(),await this.login()}async login(){a().debug('start "New Tab Auth"');try{const e=await this.loginInNewTabResultPromise;if(e){const t=new j.KJ(e);this.userManager.storeUser(t),this.collectMetrics(t.access_token)}else!this.isMobile||this.isChrome||this.eventsSubscribed||(this.events.forEach((e=>{document.addEventListener(e,this.handleClick,{once:!0})})),this.eventsSubscribed=!0,a().debug("Subscribed to user interaction events for retry login")),a().warn("New tab auth error: Authorization Code Response was not generated, register fallback click event"),this.collectMetrics("New tab auth error: Authorization Code Response was not generated, register fallback click event",!0)}catch(e){a().warn(`"New Tab Auth" error: ${e}`),this.collectMetrics(`"New Tab Auth" error: ${e}`,!0)}}async collectMetrics(e,t=!1){if(t)(0,$.k)(e);else{const t=await(0,$.t)(e);(0,$.k)(t)}}async getUser(){return this.userManager.getUser()}}var K=i(595);const G=new class{constructor(e){var t,i;i=void 0,(t="loginManager")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.loginManager=e.loginInNewTab?new z(e):new K.m(e)}queueLogin(){return this.loginManager.queueLogin()}async getUser(){return this.loginManager.getUser()}}(r.qQ),Q="idw-impression-counter",J=new class{constructor(e){var t,i;i=void 0,(t="loginProvider")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.loginProvider=e}async sendData(e,t){try{e.cohort_ids=localStorage.getItem(s.Hh.IdwCohortIdsKey)?JSON.parse(localStorage.getItem(s.Hh.IdwCohortIdsKey)):null,e.cohort_ids||(e.temp_data=Object.keys(localStorage))}catch(t){e.temp_data="error during cohort_ids reading from local storage"}const i=t?`${r.qQ.idwServicesConf.idwMetricsRootUrl}/v3/collect/impression`:`${r.qQ.idwServicesConf.idwMetricsRootUrl}/v3/anon/collect/impression`,n={method:"POST",headers:t?{"Content-Type":"application/json",Authorization:"Bearer "+t}:{"Content-Type":"application/json"},body:JSON.stringify(e)};a().debug("Sending impression to server",e);try{return(await(0,q.n)(i,n)).ok}catch(e){a().warn("Sending impression failed ",e)}}hasAnyKey(e){return!!e&&Object.keys(e).length>0}async cacheAndSendData(e){const t=await this.loginProvider.getUser(),i=JSON.parse(localStorage.getItem(Q))??[];if(!!sessionStorage.getItem(s.Hh.isOofUrl)||i.push(e),sessionStorage.removeItem(s.Hh.isOofUrl),t){let e=0;for(;e<i.length;)this.hasAnyKey(i[e])?await this.sendData(i[e],t.access_token)?i.splice(e,1):e++:i.splice(e,1)}else await this.sendData(e);localStorage.setItem(Q,JSON.stringify(i))}}(G);var V=i(55);function Y(e,t){let i;i=e<=3?0:e>3&&e<=20?.1:e/200;const n=t/100;let r;r=n<.1?0:n>=.1&&n<.25?.05:n>=.25&&n<.5?.075:.1;const s=i+r;return Math.round(100*s)/100}const X={maxScrollPosition:0,getMaxScroll:function(){return Math.round(this.maxScrollPosition)},updateMaxScroll:function(){const e=function(){const e=document.documentElement,t=document.body,i="scrollTop",n="scrollHeight";return(e[i]||t[i])/((e[n]||t[n])-e.clientHeight)*100||0}();e>this.maxScrollPosition&&(this.maxScrollPosition=e)},subscribeToScrollEvent:function(){window.addEventListener("scroll",(()=>{this.updateMaxScroll()}))}};function Z(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}X.subscribeToScrollEvent();const ee=new class{constructor(){Z(this,"observers",new Map),Z(this,"dataLayerPushHandler",void 0),Z(this,"lastNotifiedUrls",{oldUrl:"",newUrl:""}),this.dataLayerPushHandler=this.handleDataLayerPush.bind(this),window.dataLayer?this.overrideDataLayerPush():window.addEventListener("dataLayer.push",this.overrideDataLayerPush.bind(this))}overrideDataLayerPush(){const e=window.dataLayer.push;window.dataLayer.push=(...t)=>{e.apply(window.dataLayer,t),this.dataLayerPushHandler(t)}}handleDataLayerPush(e){if(e[0]&&e[0].event?.includes("gtm.historyChange")){const t=e[0],i=t["gtm.oldUrl"],n=t["gtm.newUrl"];this.lastNotifiedUrls.oldUrl===i&&this.lastNotifiedUrls.newUrl===n||(this.lastNotifiedUrls={oldUrl:i,newUrl:n},this.notifyObservers(i,n))}}notifyObservers(e,t){const i=Array.from(this.observers.values());for(const n of i)n(e,t)}addEventListener(e){const t=Symbol();return this.observers.set(t,e),t}removeEventListener(e){this.observers.delete(e)}};function te(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ie{constructor(e){te(this,"allImpressions",void 0),te(this,"isCounting",void 0),this.allImpressions=e,this.isCounting=!1,this.countGptImpressions()}countGptImpressions(){const e=window.googletag;e&&e.pubads&&e.pubads().addEventListener("slotRenderEnded",this.handleSlotRenderEnded.bind(this))}start(){this.isCounting=!0}stop(){this.isCounting=!1}handleSlotRenderEnded(e){if(!this.isCounting)return;const t=window.googletag;if(t&&t.pubads)try{if(!1===e.isEmpty){const i=e.slot.getSlotElementId(),n=this.determineMediaType(e),r="Anonymised".toLowerCase(),o={mediaType:n,hasAnonymised:[...e.slot.getTargetingKeys(),...t.pubads().getTargetingKeys()].some((e=>e.toLowerCase().includes(r))),isWinningBid:!0,bidderCode:"google",compoundId:`${i}_${e.creativeId}`};this.allImpressions[o.compoundId]?a().debug("GAM Impression already counted:",o.compoundId):(this.allImpressions[o.compoundId]=o,delete o.compoundId,localStorage.setItem(s.Hh.IdwImpressionsKey,JSON.stringify(this.allImpressions)))}}catch(e){a().warn("Error in the slotRenderEnded event handler",e)}}determineMediaType(e){try{const t=e.slot.getSlotElementId();return t.includes("video")?"video":t.includes("native")?"native":t.includes("banner")?"banner":null===e.size?"native":Array.isArray(e.size)&&2===e.size.length&&1===e.size[0]&&1===e.size[1]?"video":"banner"}catch(e){return a().warn("Failed to determine media type:",e),"banner"}}}class ne{constructor(e,t){te(this,"prebidAuctions",void 0),te(this,"allImpressions",void 0),te(this,"sentImpressionKeys",void 0),te(this,"isCounting",void 0),this.prebidAuctions={},this.sentImpressionKeys=t??[],this.allImpressions=e,this.isCounting=!1,this.countPrebidImpressions()}start(){this.isCounting=!0}stop(){this.isCounting=!1}countPrebidImpressions(){try{const e=(window?._pbjsGlobals??["pbjs"])[0],t=window[e];if(!t||!t.que)return;t.que.push((()=>{const e=t.getEvents().filter((({eventType:e})=>"auctionEnd"===e));this.prebidAuctions=e.reduce(((e,{args:t})=>(e[t.auctionId]={auctionId:t.auctionId,bidderRequests:t.bidderRequests,bidsReceived:t.bidsReceived,timestamp:t.timestamp},e)),{}),t.onEvent("auctionEnd",(e=>{if(this.prebidAuctions[e.auctionId]={auctionId:e.auctionId,bidderRequests:e.bidderRequests,bidsReceived:e.bidsReceived,timestamp:e.timestamp},!this.isCounting)return;const i=Object.values(this.prebidAuctions).reduce(((e,t)=>(e.push(...t.bidsReceived),e)),[]),n=t.getAllWinningBids()||[],r=i.map((e=>{const t=this.prebidAuctions[e.auctionId]?.bidderRequests.find((({bidderCode:t})=>t===e.bidderCode));return{compoundId:`${e.adUnitCode}_${e.adId}`,mediaType:e.mediaType,bidderCode:e.bidderCode,adUnitCode:e.adUnitCode,isWinningBid:n.some((t=>t.adId===e.adId)),hasAnonymised:t?.ortb2?.user?.data?.findIndex((e=>e?.name?.indexOf("anonymised")>-1))>-1||t?.ortb2?.user?.keywords?.indexOf("perid=default")>-1}}));this.allImpressions=r.reduce(((e,t)=>{const i=t.compoundId;return this.sentImpressionKeys.includes(i)?(a().debug("Prebid Impression already counted on previous page view:",i),e):{appnexus:!0,smartadserver:!0,pubmatic:!0,onetag:!0}[t.bidderCode]?(e[i]={mediaType:t.mediaType,hasAnonymised:t.hasAnonymised,isWinningBid:t.isWinningBid,bidderCode:t.bidderCode},e):(a().debug("Skip counting Prebid Impression from not allowed bidder:",t.bidderCode),e)}),this.allImpressions),localStorage.setItem(s.Hh.IdwImpressionsKey,JSON.stringify(this.allImpressions))}))}))}catch(e){a().warn("Failed to count Prebid impressions:",e)}}}class re{constructor(e){te(this,"allImpressions",void 0),te(this,"observer",null),te(this,"reduceParameters",((e,t)=>(e[t[0]]=t[1],e))),this.allImpressions=e}start(){window.PerformanceObserver&&window.PerformanceObserver.supportedEntryTypes.includes("resource")?(()=>{this.observer=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{"fetch"!==e.initiatorType&&"xmlhttprequest"!==e.initiatorType||!/(pubads.g.doubleclick.net|pagead2.googlesyndication.com|g.doubleclick.net)/.test(e.name)||(this.handleRequest(e.name),r.qQ.gptTargetingOn&&!e.name.toLocaleLowerCase().includes("anonymised")&&a().warn("GPT Targeting is enabled but the AD request does not include anonymised segments"))}))})),this.observer.observe({entryTypes:["resource"]})})():a().warn("PerformanceObserver not supported in this browser. Will not be able to count Amazon TAM impressions.")}stop(){this.observer&&(this.observer.disconnect(),this.observer=null)}handleRequest(e){try{const t=e=>{if(!e)return{};const t=e.split("&").filter((e=>/^enc_prev_ius|^iu_parts|^prev_iu_szs|^iu|^prev_scp|^cust_params|^correlator|^amzn|^fp/.test(e))),i={};return t.forEach((e=>{const[t,n]=e.split("=");i[t]=decodeURIComponent(n)})),Object.keys(i).length>0&&a().debug("TAM parsed url parameters",i),i},i=e=>{const t=[],i={targeting:{},adUnit:"",amzniid:void 0,amznbid:void 0,amznsz:void 0,hb_format:void 0,hb_adid:void 0,sizes:[]};return e.prev_iu_szs?e.prev_iu_szs.split(",").forEach((e=>{t.push({...i,sizes:e.split("|")})})):e.iu&&t.push(i),Object.assign(e,{slots:t}),e},n=e=>{const t=[],i=this.parseCustomParams(e);return e.prev_scp&&(e.prev_scp.split("|")||[]).forEach((e=>{const i=(e.split("&")||[]).map((e=>e.split("="))).reduce(this.reduceParameters,{});i&&t.push(i)})),e.slots.forEach(((n,r)=>{let s=[];if(e.iu_parts&&e.enc_prev_ius){const t=e.iu_parts.split(",");s=e.enc_prev_ius.split(",").map((e=>e.split("/"))).map((e=>e.map((e=>t[e])).join("/")))}else e.iu&&s.push(e.iu);n.targeting=t[r],Object.assign(n.targeting||{},i||{}),n.adUnit=s[r],n.amzniid=t[r]?.amzniid,n.amznbid=t[r]?.amznbid,n.amznsz=t[r]?.amznsz,n.hb_format=t[r]?.hb_format??"banner",n.hb_adid=t[r]?.hb_adid})),{slots:e.slots}},r=(e,t)=>e.concat(t.slots),o=(e,t)=>{if(!e)return!1;const i=t.toLowerCase();return Object.keys(e).some((e=>e.toLowerCase()===i))},c=e=>[{name:e}].map((e=>e.name.split("?")[1])).map(t).map(i).map(n).reduce(r,[]),d=c(e);d.length>0&&(a().debug("TAM slots with bids",d),d.map((e=>{const t=e.hb_adid;return{mediaType:e.hb_format,hasAnonymised:o(e.targeting,"anonymised"),isWinningBid:!!e.amznbid&&!!e.amzniid,bidderCode:"amazon",compoundId:`${e.adUnit}${t?`_${t}`:""}`}})).forEach((e=>{this.allImpressions[e.compoundId]?a().debug("TAM new Impression already counted:",e):(this.allImpressions[e.compoundId]=e,delete e.compoundId,localStorage.setItem(s.Hh.IdwImpressionsKey,JSON.stringify(this.allImpressions)))})))}catch(e){a().warn("TAM Error handling intercepted request:",e)}}parseCustomParams(e){return(e.cust_params&&e.cust_params.split("&")||[]).map((e=>e.split("="))).reduce(this.reduceParameters,{})}}class se{constructor(){te(this,"allImpressions",void 0),te(this,"sentImpressionKeys",void 0),te(this,"gptBidCounter",void 0),te(this,"prebidBidCounter",void 0),te(this,"tamBidCounter",void 0),this.sentImpressionKeys=[],this.allImpressions={},this.gptBidCounter=new ie(this.allImpressions),this.prebidBidCounter=new ne(this.allImpressions,this.sentImpressionKeys),this.tamBidCounter=new re(this.allImpressions)}start(){this.gptBidCounter.start(),this.prebidBidCounter.start(),this.tamBidCounter.start()}stop(){this.gptBidCounter.stop(),this.prebidBidCounter.stop(),this.tamBidCounter.stop()}clearImpressions(){try{localStorage.removeItem(s.Hh.IdwImpressionsKey),this.sentImpressionKeys=Object.keys(this.allImpressions).reduce(((e,t)=>(this.sentImpressionKeys.includes(t)||e.push(t),e)),this.sentImpressionKeys);for(const e in this.allImpressions)this.allImpressions[e]&&delete this.allImpressions[e]}catch(e){a().warn("Failed to clear impressions:",e)}}}function oe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ae=new class{constructor(e={}){oe(this,"startStopTimes",void 0),oe(this,"idleTimeoutMs",void 0),oe(this,"idleCheckIntervalMs",void 0),oe(this,"currentIdleTimeMs",void 0),oe(this,"isUserIdle",void 0),oe(this,"isTracking",void 0),oe(this,"idleCheckInterval",void 0),this.startStopTimes=[],this.idleTimeoutMs=e.idleTimeoutMs||3e4,this.idleCheckIntervalMs=250,this.currentIdleTimeMs=0,this.isUserIdle=!1,this.isTracking=!1,this.idleCheckInterval=null,this.handleUserActivity=this.handleUserActivity.bind(this),this.handleWindowBlur=this.handleWindowBlur.bind(this),this.handleWindowFocus=this.handleWindowFocus.bind(this),this.checkIdleState=this.checkIdleState.bind(this)}handleUserActivity(){this.startTimer()}handleWindowBlur(){this.stopTimer()}handleWindowFocus(){this.startTimer()}resetIdleTimer(){this.isUserIdle=!1,this.currentIdleTimeMs=0}checkIdleState(){this.isTracking&&(this.isUserIdle||(this.currentIdleTimeMs+=this.idleCheckIntervalMs,this.currentIdleTimeMs>=this.idleTimeoutMs&&(this.isUserIdle=!0,this.stopTimer())))}startTimer(){this.isTracking||(this.isTracking=!0,this.startStopTimes.push({startTime:new Date,stopTime:void 0})),this.resetIdleTimer()}stopTimer(){if(this.isTracking){const e=this.startStopTimes[this.startStopTimes.length-1];e&&!e.stopTime&&(e.stopTime=new Date),this.isTracking=!1}}initialize(){this.cleanup(),document.addEventListener("mousemove",this.handleUserActivity),document.addEventListener("keypress",this.handleUserActivity),document.addEventListener("scroll",this.handleUserActivity),document.addEventListener("click",this.handleUserActivity),window.addEventListener("blur",this.handleWindowBlur),window.addEventListener("focus",this.handleWindowFocus),this.idleCheckInterval=setInterval(this.checkIdleState,this.idleCheckIntervalMs),this.startTimer()}cleanup(){this.idleCheckInterval&&(clearInterval(this.idleCheckInterval),this.idleCheckInterval=null),document.removeEventListener("mousemove",this.handleUserActivity),document.removeEventListener("keypress",this.handleUserActivity),document.removeEventListener("scroll",this.handleUserActivity),document.removeEventListener("click",this.handleUserActivity),window.removeEventListener("blur",this.handleWindowBlur),window.removeEventListener("focus",this.handleWindowFocus)}reset(){this.cleanup(),this.startStopTimes=[],this.isTracking=!1,this.isUserIdle=!1,this.currentIdleTimeMs=0}getTotalTimeInMs(){return this.startStopTimes.reduce(((e,t)=>{const i=t.startTime;return e+((t.stopTime||(this.isTracking?new Date:t.startTime))-i)}),0)}getTotalTimeInSeconds(){return this.getTotalTimeInMs()/1e3}};function ce(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const de="idw-intscores";class le{constructor(e,t){ce(this,"isPageScoreStored",!1),ce(this,"pluginConfig",void 0),ce(this,"observerId",void 0),ce(this,"impressionCounter",void 0),ce(this,"loginProvider",void 0),this.pluginConfig=e,this.loginProvider=t;try{this.impressionCounter=new se}catch(e){a().warn("Failed to initialize ImpressionCounter:",e)}ae.initialize()}async start(){document.addEventListener("visibilitychange",this.visibilitychangeHandler.bind(this)),this.impressionCounter.start(),this.observerId=ee.addEventListener(this.spaRouteChangeHandler.bind(this)),this.sendAccumulatedInterestScores()}stop(){document.removeEventListener("visibilitychange",this.visibilitychangeHandler.bind(this)),this.impressionCounter.stop(),ee.removeEventListener(this.observerId)}spaRouteChangeHandler(e,t){a().debug("SPA route changed from:",e,"to:",t),this.sendAccumulatedInterestScores()}visibilitychangeHandler(){"hidden"!==document.visibilityState||this.isPageScoreStored||this.calculateAndStoreInterestScores()}calculateAndStoreInterestScores(e=!0){const t={value:Y(ae.getTotalTimeInSeconds(),X.getMaxScroll()),url:encodeURIComponent(window.location.href)};if(!t.url.startsWith("http"))return void a().warn(`Interest score URL is not valid: ${t.url}. Skip sending interest-score metric.`);const i=localStorage.getItem(de)?JSON.parse(localStorage.getItem(de)):[];i.push(t);try{const t=this.aggregateByUrlKey(i);return localStorage.setItem(de,JSON.stringify(t)),this.isPageScoreStored=e,t}catch(e){a().warn("Failed to aggregate interest scores:",e)}}async sendAccumulatedInterestScores(){const e=localStorage.getItem(de)?JSON.parse(localStorage.getItem(de)):this.calculateAndStoreInterestScores(!1);if(e&&e.length>0){const t=await this.loginProvider.getUser(),i=t&&!t.expired,n=i?`${this.pluginConfig.idwServicesConf.idwMetricsRootUrl}/v3/interest-scores`:`${this.pluginConfig.idwServicesConf.idwMetricsRootUrl}/v3/anon/interest-scores`;let r;try{const e=JSON.parse(localStorage.getItem(s.Hh.IdwImpressionsKey)??"{}");r=this.formatImpressionsPayload(e)}catch(e){a().warn("AnonInterestScores: Failed to parse impressions:",e)}const o={scores:e,bids:r,fe_id:V.W.feId,pageview_id:V.W.id},c={method:"POST",headers:i?{"Content-Type":"application/json",Authorization:"Bearer "+t.access_token}:{"Content-Type":"application/json"},body:JSON.stringify(o)};try{const e=await(0,q.n)(n,c),i=e.ok?await e.json():[];i.push("default"),t&&localStorage.removeItem(de),this.impressionCounter.clearImpressions();const r=new Set([...i]),o=Array.from(r);localStorage.setItem(s.Hh.IdwCohortIdsKey,JSON.stringify(o))}catch(e){a().warn("Failed to send interest scores:",e)}}}formatImpressionsPayload(e){const t={};for(const i in e){const n=e[i],r=n.bidderCode,s=n.mediaType,o=n.hasAnonymised?1:0,a=n.isWinningBid?1:0;t[r]||(t[r]={}),t[r][s]||(t[r][s]={total:0,has_anon:0,win:0,win_has_anon:0}),t[r][s].total+=1,t[r][s].has_anon+=o,t[r][s].win+=a,t[r][s].win_has_anon+=a&&o}return Object.keys(t).reduce(((e,i)=>(e.push({bidder_code:i,...t[i]}),e)),[])}aggregateByUrlKey(e){const t=e.reduce(((e,t)=>{const{url:i,value:n}=t;return"number"==typeof n&&(e.hasOwnProperty(i)?e[i]+=n:e[i]=n),e}),{});return Object.keys(t).map((e=>({url:e,value:t[e]}))).slice(-15)}}function ue(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class he{constructor(e){ue(this,"screenProvider",void 0),ue(this,"pluginConfig",void 0),ue(this,"loginProvider",void 0),ue(this,"loaded",void 0),ue(this,"anonInterestScores",void 0),this.loaded=!1,this.pluginConfig=e,this.loginProvider=G,this.screenProvider=new L(this.pluginConfig),this.anonInterestScores=new le(this.pluginConfig,this.loginProvider)}async build(){var e;this.screenProvider.injectCustomCSSOverrides(),this.screenProvider.addPluginToDOM(),this.screenProvider.addPluginButtonToDOM(),await this.buildUserSpecificUI(),this.subscribeToCmpEvents(),e=x.hasConsent.bind(x),window.addEventListener("message",(t=>async function(e,t){if("idw-impression-tracker"===e.data?.from){if(!t||!await t())return void a().debug("frequency capping is disabled due to lack of CMP consent");a().debug("impression-tracker message received",e.data,"from",e.origin),e.data?.src?async function(e){let t=null;try{t=new URL(e.src)}catch(e){return void a().warn("impression-tracker received campaign.js src is not a valid URL")}if(!t)return;const i={fe_id:V.W.feId},n=t.searchParams,r=n.get("itId"),s=n.get("campaignId"),o=n.get("creativeId"),c=n.get("publisherId"),d=n.get("placementId"),l=n.get("ePlacementId"),u=n.get("t"),h=n.get("cb");r&&(i.it_id=r),(e.t||u)&&(i.t=e.t??u),i.href=window?.location?.href,d&&(i.placement_id=d),l&&(i.e_placement_id=l),h&&(i.cb=h),e.adId&&(i.ad_id=e.adId),i.temp_data=e.tm?e.tm:"empty",s&&(i.campaign_id=s),o&&(i.creative_id=o),c&&(i.publisher_id=c),await J.cacheAndSendData(i)}({src:e.data.src,t:e.data.t,adId:e.data.id,tm:e.data.tm}):a().warn("impression-tracker message is missing required `src` value")}}(t,e)))}subscribeToCmpEvents(){x.onConsentChanged((async()=>{const e=await this.loginProvider.getUser(),t=x.hasConsent();a().info(`CMP consent set to ${t}`),null===e&&t&&await this.loginProvider.queueLogin(),t||this.loaded||(async function(){const e={method:"GET",headers:{"Content-Type":"application/json"}};try{await(0,q.n)(`${r.qQ.idwServicesConf.idwMetricsCollector}`,e)}catch(e){a().warn("metrics collector api ping error:",e)}}(),this.loaded=!0),this.handleCollectScripts(t)}))}async handleCollectScripts(e){e?(this.anonInterestScores.start(),M(this.pluginConfig)):(N(this.pluginConfig),this.anonInterestScores.stop())}async buildUserSpecificUI(){null===await this.loginProvider.getUser()?this.screenProvider.shouldHidePluginButton(!0):(this.screenProvider.navigateToScreenLoggedInMain(),this.screenProvider.shouldHidePluginButton(this.pluginConfig.hideButton))}}function ge(){a().info("start Anonymised Marketing Tag"),new he(r.qQ).build().catch((e=>{a().error(`Error during the Tag loading ${r.qQ.idwServicesConf.idwBidderCheckerScript}: ${e}`)}))}},319:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});const n="0.3.25a"},908:(e,t,i)=>{"use strict";var n=i(57),r=i(65),s=i.n(r);async function o(){return new Promise((e=>{n.qQ.overrideHasConsent||n.qQ.softPrivacyRegulated?(s().debug("Consider TCF API ready because of overrideHasConsent or softPrivacyRegulated is true"),e(!0)):window.__tcfapi?window.__tcfapi("ping",2,(t=>{e("loaded"===t.cmpStatus)})):e(!1)}))}async function a(){return new Promise((e=>{e(window.OneTrust||window.Optanon)}))}async function c(){return new Promise((e=>{e(!!window._iub?.cs?.consent?.purposes)}))}var d=i(55);async function l(){return![].some((e=>location.host.indexOf(e)>-1))}var u=i(245),h=i(384),g=i(595),p=i(316),w=i(319);async function m(e,t,i=100){async function n(e){return new Promise((t=>{setTimeout((()=>{t(!0)}),e)}))}let r=0,s=await e();for(;!s&&r<=i;)await n(100),s=await e(),r++;if(!s)throw t}async function f(){return new Promise((e=>{e(!!window.Bootstrapper?.gateway)}))}var _=i(274),v=i(131);const y=s().methodFactory;if(s().methodFactory=function(e,t,i){const r=y(e,t,i);return function(i){r(`Anonymised tag: ${i}`);const o="string"==typeof i?(e=>{if(e.includes(".")){const t=e.split(".");return t[t.length-1]}return e})(i):JSON.stringify(i);!async function(e){const{type:t,level:i,message:r}=e;if(!n.qQ?.errorReportingLevel)return;if(!((e,t)=>{switch(e){case s().levels.TRACE:return!0;case s().levels.DEBUG:return[v.F.DEBUG,v.F.INFO,v.F.WARN,v.F.ERROR].includes(t);case s().levels.INFO:return[v.F.INFO,v.F.WARN,v.F.ERROR].includes(t);case s().levels.WARN:return[v.F.WARN,v.F.ERROR].includes(t);case s().levels.ERROR:return[v.F.ERROR].includes(t);default:return!1}})(i,t))return;const o={err_type:`${t}: ${r}`},a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};try{const{ok:e}=await(0,_.n)(`${n.qQ.idwServicesConf.idwErrorReportingUrl}`,a);return e}catch(e){return!1}}({type:e,level:t,message:o})}},s().setLevel(s().getLevel()),window.location.search.includes("hydra-error")||window.location.search.includes("error=")){const e="PROD"===n.qQ.type?600:20,t=window.localStorage.getItem("idw-signin-from")??"/";u.j.set(h.Hh.IdwHydraHasErrorKey,!0,e),window.history.replaceState({},"",t)}function b(){Promise.resolve().then(i.bind(i,122)).then((({app:e})=>{e()}))}!async function(){if(window.location.search.includes("callback=in")){const e=document.createElement("meta");e.name="robots",e.content="noindex",document.head.appendChild(e),await g.m.handleCallback();const t=window.localStorage.getItem("idw-signin-from")??"/";s().debug(`replacing url back to ${t}`),window.history.replaceState({},"",t),sessionStorage.setItem(h.Hh.isOofUrl,"true");const i=window.sessionStorage.getItem(h.Hh.idwScrollY);i&&setTimeout((()=>{window.scrollTo(0,Number(i)),window.sessionStorage.removeItem(h.Hh.idwScrollY)}),50)}window._anonymised_tag={version:w.A,getConfig:()=>({...n.qQ})},(e=>{switch(e){case v.F.SILENT:s().setLevel(s().levels.SILENT);break;case v.F.ERROR:s().setLevel(s().levels.ERROR);break;case v.F.WARN:s().setLevel(s().levels.WARN);break;case v.F.INFO:s().setLevel(s().levels.INFO);break;case v.F.DEBUG:s().setLevel(s().levels.DEBUG);break;case v.F.TRACE:s().setLevel(s().levels.TRACE);break;default:s().setLevel(s().levels.INFO)}})(n.qQ.errorReportingLevel),window.self===window.top?function(){if([...Array.from(document.querySelectorAll('script[src*="static.anonymised.io/light/bundle"]')),...Array.from(document.querySelectorAll('script[src*="idward-cmp-v2-dev/light/bundle"]')),...Array.from(document.querySelectorAll('script[src*="localhost:3000/bundle.js"]'))].length>1){const e=d.W.id;window[`anon_instance_${e}`]=Date.now();const t=Object.keys(window).filter((e=>e.startsWith("anon_instance_")));return t.sort(((e,t)=>window[e]-window[t])),!t[0]?.includes(e)}return!1}()?s().warn("Another instance of the Anonymised tag script already running on the page! Stop rendering this instance"):n.qQ?.clientId&&"string"==typeof n.qQ?.clientId&&""!==n.qQ?.clientId.trim()&&(s().debug(`Client ID is present - ${n.qQ.clientId}`),1)?function(){try{const e=/bot\\b|index|Googlebot|spider|crawl|wget|slurp|sogou|baiduspider|Mediapartners-Google/i;return-1!==navigator.userAgent.search(e)||!window.document||!window.document.getElementsByTagName}catch{return!1}}()?s().warn("Anonymised tag will not start. Bot detected on site"):window.location.protocol.startsWith("file:")?s().warn("Anonymised tag will not start. Running on file protocol"):Promise.all([l(),(0,p.b)(),(0,n.rY)(),!!n.qQ.cmpProviderCookieGroup||m(o,"waiting for TCF API to be ready",140),!(n.qQ.cmpProvider&&n.qQ.cmpProvider.includes(h.P_.OneTrust))||m(a,"waiting for OneTrust API to be ready",80),!(n.qQ.cmpProvider&&n.qQ.cmpProvider.includes(h.P_.Iubenda))||m(c,"waiting for Iubenda API to be ready",80),!(n.qQ.cmpProvider&&n.qQ.cmpProvider.includes(h.P_.Ensighten))||m(f,"waiting for Ensighten API to be ready",80)]).then((e=>{if(e[0]&&e[1]){const e=window.localStorage.getItem(h.Hh.IdwCohortIdsKey);n.qQ.gptTargetingOn&&e&&window.googletag&&window.googletag.cmd.push((()=>{const t=window.googletag.pubads().getTargetingKeys()?.some((e=>e.toLowerCase()===h.Hh.anonymised));t||window.googletag.pubads().setTargeting(h.Hh.anonymised,JSON.parse(e))})),"complete"===document.readyState?(s().debug("Tag is already loaded"),b()):window.addEventListener("load",(function(){s().debug("Tag loaded via load event"),b()}))}else e[0]?e[1]||console.warn(`Anonymised tag will not start. The domain '${window.location.hostname}' is pending verification`):s().warn(`Anonymised tag will not start. Disabled on the '${window.location.hostname}' domain`)})).catch((e=>{s().warn(`Tag will not start because of the timeout while ${e}`)})):s().warn("Anonymised tag will not start. Client ID is not specified"):s().warn("Anonymised tag will not start. Not running in the top frame")}()},316:(e,t,i)=>{"use strict";i.d(t,{b:()=>a});var n=i(57),r=i(274),s=i(65),o=i.n(s);async function a(){const e={method:"GET",headers:{"Content-Type":"application/json"}};try{const t=await(0,r.n)(`${n.qQ.idwServicesConf.idwHealthCheckUrl}`,e);return o().debug(`Health check response.url from ${n.qQ.idwServicesConf.idwHealthCheckUrl}:`,t?.url),t?.ok&&t?.url===n.qQ.idwServicesConf.idwHealthCheckUrl}catch(e){return!1}}},241:(e,t,i)=>{"use strict";i.d(t,{g:()=>o});var n=i(625),r=i(905);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class o{constructor(e){s(this,"pluginConfig",void 0),s(this,"userManager",void 0),s(this,"baseOidcConf",void 0),this.pluginConfig=e,this.baseOidcConf={...this.pluginConfig.oidcConf,automaticSilentRenew:!1,userStore:new n.O({store:r.nX})};const t=Number(localStorage.getItem("idw-renew"));t&&t>0&&(this.baseOidcConf.accessTokenExpiringNotificationTimeInSeconds=t),this.userManager=new n.$5(this.baseOidcConf)}isLoginExceptionPage(){const e=this.pluginConfig.loginExceptionPages?.some((e=>window.location.href.includes(e.toLocaleLowerCase())));return e}isLoginInclusionPage(){return!this.pluginConfig.loginInclusionPages||this.pluginConfig.loginInclusionPages.some((e=>window.location.href.includes(e.toLocaleLowerCase())))}}},905:(e,t,i)=>{"use strict";i.d(t,{nX:()=>u});var n=i(57);class r{constructor(e={path:"/"}){var t,i;i=void 0,(t="defaultAttributes")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.defaultAttributes=e}setItem(e,t,i={}){const n={...this.defaultAttributes,...i};let r=encodeURIComponent(e)+"="+encodeURIComponent(t);if(n.expires){if("number"==typeof n.expires){const e=new Date;e.setTime(e.getTime()+24*n.expires*60*60*1e3),n.expires=e}r+="; expires="+n.expires.toUTCString()}n.path&&(r+="; path="+n.path),n.domain&&(r+="; domain="+n.domain),n.secure&&(r+="; secure"),n.sameSite&&(r+="; SameSite="+n.sameSite),document.cookie=r}getItem(e){const t=(document.cookie?document.cookie.split("; "):[]).find((t=>t.startsWith(`${encodeURIComponent(e)}=`)));return t?decodeURIComponent(t.split("=")[1]):null}removeItem(e){this.setItem(e,"",{expires:-1})}clear(){const e=document.cookie.split(";");for(const t of e){const e=t.indexOf("="),i=e>-1?t.substring(0,e):t;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}}var s=i(65),o=i.n(s);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const c=`oidc.user:${n.qQ.oidcConf.authority}`,d={secure:!0,path:"/",domain:(l=window.location.hostname,l.replace(/^www\./,"").split(".").slice(-2).join(".")),sameSite:"None",expires:365};var l;const u=new class{constructor(e,t){a(this,"pluginConfig",void 0),a(this,"cookieStoreKey",void 0),a(this,"cookieStorage",void 0),this.pluginConfig=t,this.cookieStoreKey=e,this.cookieStorage=new r(d),o().debug(`LocalStorageCookieFallback: extendLoginToSubdomains: ${t.extendLoginToSubdomains}`)}getItem(e){let t=localStorage.getItem(e);return this.pluginConfig.extendLoginToSubdomains&&null===t?(t=this.cookieStorage.getItem(this.cookieStoreKey),t&&localStorage.setItem(e,t)):this.pluginConfig.extendLoginToSubdomains&&t&&this.cookieStorage.setItem(this.cookieStoreKey,t),t}setItem(e,t){localStorage.setItem(e,t),this.pluginConfig.extendLoginToSubdomains&&this.cookieStorage.setItem(this.cookieStoreKey,t)}removeItem(e){localStorage.removeItem(e),this.cookieStorage.removeItem(this.cookieStoreKey)}clear(){localStorage.clear(),this.cookieStorage.removeItem(this.cookieStoreKey)}key(e){return localStorage.key(e)}get length(){return localStorage.length}}(c,n.qQ)},595:(e,t,i)=>{"use strict";i.d(t,{m:()=>m});var n=i(625),r=i(57),s=i(241),o=i(245),a=i(384),c=i(65),d=i.n(c),l=i(815),u=i(316),h=i(905),g=i(274),p=i(123);function w(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class m extends s.g{constructor(e){super(e),w(this,"loginLock",void 0),w(this,"pageUnloading",void 0),w(this,"visibilitychangeSubscribed",void 0),this.userManager.events.addAccessTokenExpired((()=>{d().debug("token expired, will queue OOF"),this.queueLogin()})),this.userManager.events.addAccessTokenExpiring((()=>{d().debug("token expiring, will queue OOF"),this.queueLogin()}))}async queueLogin(){if(!this.pluginConfig.notLoginUser){const e=this.isImmediateLoginPage();let t=this.isLoginExceptionPage(),i=this.isLoginInclusionPage();if(e&&!t&&i)return void this.tryLogin();d().debug("queue OOF"),window.addEventListener("beforeunload",(()=>{this.pageUnloading=!0})),this.visibilitychangeSubscribed?d().debug("visibilitychange already added, will not subscribe once more"):(d().debug("addEventListener visibilitychange"),this.visibilitychangeSubscribed=!0,addEventListener("visibilitychange",(()=>{t=this.isLoginExceptionPage(),i=this.isLoginInclusionPage(),"hidden"===document.visibilityState&&!t&&i&&this.tryLogin()})))}}isImmediateLoginPage(){const e=this.pluginConfig.immediateLoginPages?.some((e=>window.location.href.includes(e.toLocaleLowerCase())));return e}async tryLogin(e=window.location.href){if(this.loginLock||this.pageUnloading)return;const t=Date.now(),i=await(0,u.b)(),n=Date.now()-t;if(i&&n<=1750)await this.login(e);else if(i){d().warn("health check took more than 1750ms, network connection is too slow. Will not do OOF");const e={method:"GET",headers:{"Content-Type":"application/json",acc_uuid:window.localStorage.getItem(a.Hh.idwOutdated),url:encodeURIComponent(window.location.href),health_check_time:n.toString()}};(0,g.n)(`${r.qQ.idwServicesConf.idwMetricsCollector}/debug/health`,e).catch((e=>{console.warn("Anonymised tag: failed to GET metrics/collect/debug/health",e)}))}else d().warn("health check has failed, will not do OOF")}async login(e){if(this.loginLock)return;if(this.loginLock=!0,window.location.search.includes("callback=in"))return void d().debug("terminate an attempt to OOF during the callback redirect");if(o.j.get(a.Hh.IdwHydraHasErrorKey)){const e="Error: terminate an attempt to OOF while being in PLUGIN_OFFLINE mode";return void d().debug(e)}window.localStorage.setItem("idw-signin-from",e),window.sessionStorage.setItem(a.Hh.idwScrollY,window.scrollY.toString());const t={...this.baseOidcConf,redirect_uri:(0,l.Q)(e,{callback:"in"})},i=window.localStorage.getItem(a.Hh.idwOutdated);i&&(t.extraQueryParams={outdated:i}),d().debug("update oidcConf.redirect_uri:",t.redirect_uri),this.userManager=new n.$5(t),d().debug("start OOF");try{await this.userManager.signinRedirect({state:{signInFrom:window.location.href}})}catch(e){d().warn(`OOF error: ${e}`)}}async getUser(){return this.userManager.getUser()}static async handleCallback(e=r.qQ){const t={...e.oidcConf,automaticSilentRenew:!1,userStore:new n.O({store:h.nX})},i=new n.$5(t);try{const e=await i.signinRedirectCallback();if(e.expires_in){const t=Math.round(e.expires_in/3).toString();window.localStorage.setItem("idw-renew",t)}const t=await(0,p.t)(e.access_token);(0,p.k)(t),localStorage.setItem(a.Hh.idwOutdated,t)}catch(e){(0,p.k)("OOF callback error"),console.error("Anonymised tag: OOF callback error",e)}finally{console.debug("Anonymised tag: OOF callback done")}}}},123:(e,t,i)=>{"use strict";i.d(t,{k:()=>o,t:()=>a});var n=i(765),r=i(57),s=i(274);function o(e){const t={method:"GET",headers:{"Content-Type":"application/json",acc_uuid:e,url:encodeURIComponent(window.location.href)}};(0,s.n)(`${r.qQ.idwServicesConf.idwMetricsCollector}/ok`,t).catch((e=>{console.warn("Anonymised tag: failed to GET metrics/collect/ok",e)}))}async function a(e){try{return(0,n.A)(e).sub}catch(e){return console.warn("Anonymised tag: failed to parse JWT token",e),null}}},57:(e,t,i)=>{"use strict";i.d(t,{rY:()=>S,qQ:()=>b});var n=i(815),r=i(319),s=i(131);const o="https://aegis.dev.anonymised.io",a="https://aegis.dev.anonymised.io",c={type:"DEV",oidcConf:{authority:o,client_id:window.location.origin,redirect_uri:(0,n.Q)(window.location.href,{callback:"in"}),response_type:"code",scope:"token profile id_token",metadata:{issuer:o,authorization_endpoint:`${o}/oauth2/auth`,userinfo_endpoint:`${o}/userinfo`,token_endpoint:`${a}/oauth2/token`},accessTokenExpiringNotificationTimeInSeconds:600},idwServicesConf:{idwMetricsRootUrl:"https://material.dev.anonymised.io",idwMetricsCollector:"https://material.dev.anonymised.io/metrics/collect",idwRetargetingScript:"https://storage.googleapis.com/idward-cmp-v2-dev/light/retargeting.js",idwBidderCheckerScript:`https://storage.googleapis.com/idward-cmp-v2-dev/light/bidderchecker.js?v=${r.A}`,idwDataAccountWebUrl:"https://data-account-web-lwvpr3pb6a-ew.a.run.app",idwRetargetingSegmentsUrl:"https://user-segments-lwvpr3pb6a-ew.a.run.app/retargeting",idwHealthCheckUrl:`${a}/health`,idwErrorReportingUrl:"https://material.dev.anonymised.io/v3/error"},notIntegrateCmp:!1,overrideHasConsent:!1,softPrivacyRegulated:!1,hideButton:!1,notLoginUser:!1,retargetingOn:!1,gptTargetingOn:!1,extendLoginToSubdomains:!1,errorReportingLevel:s.F.ERROR,cohortPollingInterval:1,loginInNewTab:!1},d="https://account.anonymised.io/login",l="https://aegis.anonymised.io",u={type:"PROD",oidcConf:{authority:d,client_id:window.location.origin,redirect_uri:(0,n.Q)(window.location.href,{callback:"in"}),response_type:"code",scope:"token profile id_token",metadata:{issuer:d,authorization_endpoint:`${d}/oauth2/auth`,userinfo_endpoint:`${d}/userinfo`,token_endpoint:`${l}/oauth2/token`},accessTokenExpiringNotificationTimeInSeconds:259200},idwServicesConf:{idwMetricsRootUrl:"https://material.anonymised.io",idwMetricsCollector:"https://material.anonymised.io/metrics/collect",idwRetargetingScript:"https://static.anonymised.io/light/retargeting.js",idwBidderCheckerScript:`https://static.anonymised.io/light/bidderchecker.js?v=${r.A}`,idwDataAccountWebUrl:"https://account.anonymised.io",idwRetargetingSegmentsUrl:"https://user-segments.anonymised.io/retargeting",idwHealthCheckUrl:`${l}/health`,idwErrorReportingUrl:"https://material.anonymised.io/v3/error"},notIntegrateCmp:!1,overrideHasConsent:!1,softPrivacyRegulated:!1,hideButton:!1,notLoginUser:!1,retargetingOn:!1,gptTargetingOn:!1,extendLoginToSubdomains:!1,errorReportingLevel:s.F.ERROR,cohortPollingInterval:12,loginInNewTab:!1};var h=i(65),g=i.n(h),p=i(384),w=i(274);async function m(e){const t={method:"GET",headers:{"Content-Type":"application/json"}};try{const i="DEV"===e?"https://material.dev.anonymised.io/v3/tag/configs":"https://material.anonymised.io/v3/tag/configs",n=await(0,w.n)(i,t);return{config:await n.json(),isTagVerified:!0}}catch(e){let t=!0;return e.toString().includes("TypeError")&&(t=!1),{isTagVerified:t,config:{}}}}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _(e,t){try{return e.replace(/[[\] '"]/g,"").split(",")}catch{return void g().warn(`Error parsing '${t}' setting value ${e}`)}}const v=document.currentScript,y=new class{constructor(e,t=m,i=window.localStorage,n=window.sessionStorage){f(this,"pluginConfig",void 0),f(this,"scriptElement",void 0),f(this,"localStorage",void 0),f(this,"sessionStorage",void 0),f(this,"remoteConfigPromise",void 0),f(this,"attributeConfig",void 0),f(this,"localStorageConfig",void 0),f(this,"sessionStorageConfig",void 0),this.scriptElement=e,this.localStorage=i,this.sessionStorage=n,this.attributeConfig=this.getAttributeConfig(),this.localStorageConfig=this.getLocalStorageConfig(),this.sessionStorageConfig=this.getSessionStorageConfig();const r=this.mergeConfigs(this.attributeConfig,this.localStorageConfig,this.sessionStorageConfig),s="dev"===r.environment?"DEV":"PROD";this.remoteConfigPromise=t(s),this.pluginConfig=this.mapAttributeConfigToConfig(r),this.initRemoteConfig()}async initRemoteConfig(){const{config:e}=await this.remoteConfigPromise,t=function(e){if(!e)return{};const t={},i={colourPrimary:"colorPrimary",hideIdwButton:"hideButton",gptTargeting:"gptTargetingOn",metricsCollector:"metricsCollectorUrl",retargetingScript:"retargetingScriptUrl"};return Object.entries(e).forEach((([e,n])=>{t[i[e]||e]=n})),t}(e),i=this.mergeConfigs(this.attributeConfig,this.localStorageConfig,t,this.sessionStorageConfig);this.pluginConfig=this.mapAttributeConfigToConfig(i)}extractConfigStorageValues(e){const t={};return Object.entries(p.tF).forEach((([i,n])=>{const r=e(n)??e(p.Oq[i]);r&&(t[i]=r)})),t}getAttributeConfig(){return this.extractConfigStorageValues((e=>this.scriptElement.getAttribute(e)))}getLocalStorageConfig(){return this.extractConfigStorageValues((e=>this.localStorage.getItem(e)))}getSessionStorageConfig(){return this.extractConfigStorageValues((e=>this.sessionStorage.getItem(e)))}mergeConfigs(...e){return Object.assign({},...e)}async isTagVerified(){const{isTagVerified:e}=await this.remoteConfigPromise;return e}mapAttributeConfigToConfig(e){const t="dev"===e.environment?c:u;return e.colorPrimary&&(t.colorPrimary=e.colorPrimary),e.errorReportingLevel&&(t.errorReportingLevel=e.errorReportingLevel),e.cmpProvider&&(t.cmpProvider=e.cmpProvider),e.cmpProviderCookieGroup&&(t.cmpProviderCookieGroup=e.cmpProviderCookieGroup),e.clientId&&(t.clientId=e.clientId),e.notIntegrateCmp&&(t.notIntegrateCmp="true"===e.notIntegrateCmp),e.overrideHasConsent&&(t.overrideHasConsent="true"===e.overrideHasConsent),e.softPrivacyRegulated&&(t.softPrivacyRegulated="true"===e.softPrivacyRegulated),e.hideButton&&(t.hideButton="true"===e.hideButton),e.notLoginUser&&(t.notLoginUser="true"===e.notLoginUser),e.retargetingOn&&(t.retargetingOn="true"===e.retargetingOn),e.gptTargetingOn&&(t.gptTargetingOn="true"===e.gptTargetingOn),e.extendLoginToSubdomains&&(t.extendLoginToSubdomains="true"===e.extendLoginToSubdomains),e.loginInNewTab&&(t.loginInNewTab="true"===e.loginInNewTab),e.cohortPollingInterval&&(t.cohortPollingInterval=e.cohortPollingInterval),e.loginExceptionPages&&(t.loginExceptionPages=_(e.loginExceptionPages,p.tF.loginExceptionPages)),e.loginInclusionPages&&(t.loginInclusionPages=_(e.loginInclusionPages,p.tF.loginInclusionPages)),e.immediateLoginPages&&(t.immediateLoginPages=_(e.immediateLoginPages,p.tF.immediateLoginPages)),e.metricsCollectorUrl&&(t.idwServicesConf.idwMetricsCollector=e.metricsCollectorUrl),e.metricsRootUrl&&(t.idwServicesConf.idwMetricsRootUrl=e.metricsRootUrl),e.retargetingScriptUrl&&(t.idwServicesConf.idwRetargetingScript=e.retargetingScriptUrl),e.bidderCheckerScript&&(t.idwServicesConf.idwBidderCheckerScript=e.bidderCheckerScript),e.dataAccountWebUrl&&(t.idwServicesConf.idwDataAccountWebUrl=e.dataAccountWebUrl),e.retargetingSegmentsUrl&&(t.idwServicesConf.idwRetargetingSegmentsUrl=e.retargetingSegmentsUrl),e.healthCheckUrl&&(t.idwServicesConf.idwHealthCheckUrl=e.healthCheckUrl),e.errorReportingUrl&&(t.idwServicesConf.idwErrorReportingUrl=e.errorReportingUrl),e.authority&&(t.oidcConf={...t.oidcConf,authority:e.authority,metadata:{...t.oidcConf.metadata,issuer:e.authority,authorization_endpoint:`${e.authority}/oauth2/auth`,userinfo_endpoint:`${e.authority}/userinfo`}}),t.loginInNewTab&&(void 0!==t.immediateLoginPages&&g().warn(`${p.tF.immediateLoginPages} setting is not supported when ${p.tF.loginInNewTab} is enabled`),void 0!==t.loginExceptionPages&&g().warn(`${p.tF.loginExceptionPages} setting is not supported when ${p.tF.loginInNewTab} is enabled`),void 0!==t.loginInclusionPages&&g().warn(`${p.tF.loginInclusionPages} setting is not supported when ${p.tF.loginInNewTab} is enabled`),t.overrideHasConsent&&g().warn(`${p.tF.overrideHasConsent} setting is not supported when ${p.tF.loginInNewTab} is enabled`),t.softPrivacyRegulated&&g().warn(`${p.tF.softPrivacyRegulated} setting is not supported when ${p.tF.loginInNewTab} is enabled`),t.overrideHasConsent=!1,t.softPrivacyRegulated=!1),t}}(v),b=y.pluginConfig,S=y.isTagVerified.bind(y)},384:(e,t,i)=>{"use strict";let n,r,s,o;i.d(t,{Hh:()=>n,Oq:()=>s,P_:()=>r,tF:()=>o}),function(e){e.IdwHydraHasErrorKey="IDW_HYDRA_HAS_ERROR",e.IdwCohortIdsKey="cohort_ids",e.idwScrollY="idw-scroll-y",e.IdwImpressionsKey="idw-impressions",e.anonymised="Anonymised",e.isOofUrl="idw-oof",e.idwOutdated="idw-outdated"}(n||(n={})),function(e){e.Quantcast="quantcast",e.Consentmanager="consentmanager",e.Liveramp="liveramp",e.Clickio="clickio",e.Sourcepoint="sourcepoint",e.Iubenda="iubenda",e.Uniconsent="uniconsent",e.OneTrust="onetrust",e.CookiePro="cookiepro",e.CookieBot="cookiebot",e.Googlefc="googlefc",e.Admiral="admiral",e.Ensighten="ensighten",e.CookieScript="cookiescript",e.Klaro="klaro"}(r||(r={})),function(e){e.colorPrimary="idw_color_primary",e.errorReportingLevel="idw_error_reporting_level",e.cmpProvider="idw_cmp_provider",e.cmpProviderCookieGroup="idw_cmp_provider_cookie_group",e.environment="idw_environment",e.notIntegrateCmp="idw_not_integrate_cmp",e.overrideHasConsent="override_has_consent",e.softPrivacyRegulated="soft_privacy_regulated",e.hideButton="idw_hide_button",e.notLoginUser="not_login_user",e.retargetingOn="retargeting_on",e.gptTargetingOn="gpt_targeting_on",e.extendLoginToSubdomains="extend_login_to_subdomains",e.clientId="idw_client_id",e.cohortPollingInterval="idw_cohort_polling_interval",e.loginExceptionPages="idw_login_exception_pages",e.loginInclusionPages="idw_login_inclusion_pages",e.immediateLoginPages="idw_immediate_login_pages",e.metricsRootUrl="idw_metrics_root_url",e.metricsCollectorUrl="idw_metrics_collector_url",e.retargetingScriptUrl="idw_retargeting_script_url",e.retargetingSegmentsUrl="idw_retargeting_segments_url",e.healthCheckUrl="idw_health_check_url",e.errorReportingUrl="idw_error_reporting_url",e.authority="idw_authority"}(s||(s={})),function(e){e.colorPrimary="color-primary",e.errorReportingLevel="error-reporting-level",e.cmpProvider="cmp-provider",e.cmpProviderCookieGroup="cmp-provider-cookie-group",e.environment="environment",e.notIntegrateCmp="not-integrate-cmp",e.overrideHasConsent="override-has-consent",e.softPrivacyRegulated="soft-privacy-regulated",e.hideButton="hide-button",e.notLoginUser="not-login-user",e.retargetingOn="retargeting-on",e.gptTargetingOn="gpt-targeting-on",e.extendLoginToSubdomains="extend-login-to-subdomains",e.clientId="client-id",e.cohortPollingInterval="cohort-polling-interval",e.loginExceptionPages="login-exception-pages",e.loginInclusionPages="login-inclusion-pages",e.immediateLoginPages="immediate-login-pages",e.loginInNewTab="login-in-new-tab",e.metricsRootUrl="metrics-root-url",e.metricsCollectorUrl="metrics-collector-url",e.retargetingScriptUrl="retargeting-script-url",e.retargetingSegmentsUrl="retargeting-segments-url",e.healthCheckUrl="health-check-url",e.errorReportingUrl="error-reporting-url",e.authority="authority"}(o||(o={}))},245:(e,t,i)=>{"use strict";i.d(t,{j:()=>n});const n={set:function(e,t,i){const n={value:t,expiresAt:Date.now()+1e3*i};localStorage.setItem(e.toString(),JSON.stringify(n))},get:function(e){const t=JSON.parse(localStorage.getItem(e.toString()));if(null!==t){if(!(null!==t.expiresAt&&t.expiresAt<Date.now()))return t.value;localStorage.removeItem(e.toString())}return null}}},131:(e,t,i)=>{"use strict";let n;i.d(t,{F:()=>n}),function(e){e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e.SILENT="silent"}(n||(n={}))},55:(e,t,i)=>{"use strict";function n(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.split(/[:\/]/g).pop().toLowerCase()}i.d(t,{W:()=>r});const r=new class{constructor(){var e,t;t=void 0,(e="pageViewId")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,this.pageViewId=this.generatePageViewId(),this.updatePageViewId()}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}setCookie(e,t,i){const n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);const r=`expires=${n.toUTCString()}`;document.cookie=`${e}=${t};${r};path=/`}getOrCreateFeId(){const e="idw-fe-id";let t=localStorage.getItem(e);return t||(t=this.getCookie(e),t?localStorage.setItem(e,t):(t=n(),localStorage.setItem(e,t),this.setCookie(e,t,365))),t}generatePageViewId(){return n()}updatePageViewId(){this.pageViewId=this.generatePageViewId()}get id(){return this.pageViewId}get feId(){return this.getOrCreateFeId()}}},274:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});var n=i(319);function r(e,t={}){const i={...t};return i.headers={...i.headers,"Anon-App-Version":n.A},fetch(e,i)}},815:(e,t,i)=>{"use strict";i.d(t,{Q:()=>n});const n=(e,t)=>{const i=new URL(e),n=new URLSearchParams(i.search);for(const e in t)void 0!==t[e]&&n.set(e,t[e]);return i.search=n.toString(),i.hash="",i.toString()}},21:function(e,t,i){var n;e.exports=(n=n||function(e){var t;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==i.g&&i.g.crypto&&(t=i.g.crypto),!t)try{t=i(477)}catch(e){}var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),s={},o=s.lib={},a=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=o.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(var s=0;s<r;s++){var o=i[s>>>2]>>>24-s%4*8&255;t[n+s>>>2]|=o<<24-(n+s)%4*8}else for(var a=0;a<r;a+=4)t[n+a>>>2]=i[a>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4)t.push(n());return new c.init(t,e)}}),d=s.enc={},l=d.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var s=t[r>>>2]>>>24-r%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(i,t/2)}},u=d.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var s=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(i,t)}},h=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},g=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i,n=this._data,r=n.words,s=n.sigBytes,o=this.blockSize,a=s/(4*o),d=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,l=e.min(4*d,s);if(d){for(var u=0;u<d;u+=o)this._doProcessBlock(r,u);i=r.splice(0,d),n.sigBytes-=l}return new c.init(i,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(o.Hasher=g.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}}),s.algo={});return s}(Math),n)},754:function(e,t,i){var n,r,s;e.exports=(n=i(21),s=(r=n).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,n=this._map;e.clamp();for(var r=[],s=0;s<i;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<i;a++)r.push(n.charAt(o>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,i=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var r=0;r<i.length;r++)n[i.charCodeAt(r)]=r}var o=i.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return function(e,t,i){for(var n=[],r=0,o=0;o<t;o++)if(o%4){var a=i[e.charCodeAt(o-1)]<<o%4*2|i[e.charCodeAt(o)]>>>6-o%4*2;n[r>>>2]|=a<<24-r%4*8,r++}return s.create(n,r)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},178:function(e,t,i){e.exports=i(21).enc.Utf8},9:function(e,t,i){var n;e.exports=(n=i(21),function(e){var t=n,i=t.lib,r=i.WordArray,s=i.Hasher,o=t.algo,a=[],c=[];!function(){function t(t){for(var i=e.sqrt(t),n=2;n<=i;n++)if(!(t%n))return!1;return!0}function i(e){return 4294967296*(e-(0|e))|0}for(var n=2,r=0;r<64;)t(n)&&(r<8&&(a[r]=i(e.pow(n,.5))),c[r]=i(e.pow(n,1/3)),r++),n++}();var d=[],l=o.SHA256=s.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],u=i[6],h=i[7],g=0;g<64;g++){if(g<16)d[g]=0|e[t+g];else{var p=d[g-15],w=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,m=d[g-2],f=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;d[g]=w+d[g-7]+f+d[g-16]}var _=n&r^n&s^r&s,v=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),y=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&u)+c[g]+d[g];h=u,u=l,l=a,a=o+y|0,o=s,s=r,r=n,n=y+(v+_)|0}i[0]=i[0]+n|0,i[1]=i[1]+r|0,i[2]=i[2]+s|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0,i[5]=i[5]+l|0,i[6]=i[6]+u|0,i[7]=i[7]+h|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return i[r>>>5]|=128<<24-r%32,i[14+(r+64>>>9<<4)]=e.floor(n/4294967296),i[15+(r+64>>>9<<4)]=n,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(l),t.HmacSHA256=s._createHmacHelper(l)}(Math),n.SHA256)},353:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(314),r=i.n(n)()(!1);r.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Open+Sans:wght@500;600&display=swap);"]),r.push([e.id,"#idw-plugin-container {\n    display: flex;\n    flex-direction: column;\n    box-sizing: content-box;\n    position: fixed;\n    left: -160px;\n    bottom: -160px;\n    z-index: 999999;\n    background-color: #fff;\n\n    height: auto;\n    max-width: 160px;\n    width: 160px;\n    min-width: 160px;\n    color: #171717;\n    line-height: 1rem;\n\n    outline: 1px solid #171717;\n    justify-content: flex-start;\n\n    -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    opacity: 0;\n    transition: left .4s, bottom .4s, opacity .1s;\n}\n\n#idw-plugin-container.idw-open {\n    left: 0;\n    bottom: 0;\n    opacity: 1;\n}\n\n#idw-plugin-buttons {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    width: auto;\n}\n\n#idw-plugin-container .pluginBtn {\n    border: none;\n    padding: 1px 5px !important;\n    margin: 0 !important;\n    width: auto !important;\n    height: 25px !important;\n    box-sizing: border-box !important;\n\n    border-radius: 0 !important;\n    text-align: right !important;\n\n    font-family: 'Open Sans', sans-serif !important;\n    line-height: normal !important;\n    text-transform: none !important;\n    letter-spacing: normal !important;\n    font-weight: 600 !important;\n    font-size: 14px !important;\n\n    background-color: #ffffff !important;\n    transition: background-color 0.2s;\n    cursor: pointer !important;\n}\n\n#idw-plugin-container .pluginBtn:hover {\n    outline: 1px solid #ffffff !important;\n    background-color: #171717 !important;\n    color: #ffffff !important;\n}\n\n#idw-open-trigger {\n    position: fixed;\n    width: 50px;\n    height: 50px;\n    bottom: 0;\n    left: 0;\n    z-index: 999999;\n    cursor: pointer;\n    -webkit-clip-path: polygon(100% 100%, 0 100%, 0 0);\n    clip-path: polygon(100% 100%, 0 100%, 0 0);\n    background-color: #171717 !important;\n}\n\n#idw-open-trigger img {\n    width: 28px;\n    height: 28px;\n    position: absolute;\n    /* padding: 4px; */\n    bottom: -2px;\n    left: -2px;\n}",""]);const s=r},936:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(314),r=i.n(n)()(!1);r.push([e.id,"/***************/\n/*MEDIA QUERIES*/\n/***************/\n/*\n  ##Device: Tablets, Ipads (portrait)\n  ##Screen: B/w 768px to 1024px\n*/\n@media (min-width: 768px) and (max-width: 1024px) {\n    \n}\n/*\n  ##Device: Most of the Smartphones Mobiles (Portrait)\n  ##Screen: B/w 320px to 479px\n*/\n@media (min-width: 400px) and (max-width: 480px) {\n\n}",""]);const s=r},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,n,r,s=e[1]||"",o=e[3];if(!o)return s;if(t&&"function"==typeof btoa){var a=(i=o,n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),"/*# ".concat(r," */")),c=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[s].concat(c).concat([a]).join("\n")}return[s].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,n){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(n)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(r[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);n&&r[c[0]]||(i&&(c[2]?c[2]="".concat(i," and ").concat(c[2]):c[2]=i),t.push(c))}},t}},765:(e,t,i)=>{"use strict";function n(e){this.message=e}i.d(t,{A:()=>a}),n.prototype=new Error,n.prototype.name="InvalidCharacterError";var r="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,r,s=0,o=0,a="";r=t.charAt(o++);~r&&(i=s%4?64*i+r:r,s++%4)?a+=String.fromCharCode(255&i>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function s(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,t){var i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i})))}(t)}catch(e){return r(t)}}function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidTokenError";const a=function(e,t){if("string"!=typeof e)throw new o("Invalid token specified");var i=!0===(t=t||{}).header?0:1;try{return JSON.parse(s(e.split(".")[i]))}catch(e){throw new o("Invalid token specified: "+e.message)}}},65:function(e,t,i){var n,r;!function(){"use strict";n=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],r={},s=null;function o(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var i=this.getLevel(),r=0;r<n.length;r++){var s=n[r];this[s]=r<i?e:this.methodFactory(s,i,this.name)}if(this.log=this.debug,typeof console===t&&i<this.levels.SILENT)return"No console available for logging"}function d(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function l(n,r,s){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&i?a:void 0!==console[n]?o(console,n):void 0!==console.log?o(console,"log"):e)}(n)||d.apply(this,arguments)}function u(e,i){var o,a,d,u=this,h="loglevel";function g(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,n=encodeURIComponent(h),r=i.indexOf(n+"=");-1!==r&&(e=/^([^;]+)/.exec(i.slice(r+n.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function p(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=i||l,u.getLevel=function(){return null!=d?d:null!=a?a:o},u.setLevel=function(e,i){return d=p(e),!1!==i&&function(e){var i=(n[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+i+";"}catch(e){}}}(d),c.call(u)},u.setDefaultLevel=function(e){a=p(e),g()||u.setLevel(e,!1)},u.resetLevel=function(){d=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(s!==u&&(o=p(s.getLevel())),c.call(u),s===u)for(var e in r)r[e].rebuild()},o=p(s?s.getLevel():"WARN");var w=g();null!=w&&(d=p(w)),c.call(u)}(s=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,s.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=h),s},s.getLoggers=function(){return r},s.default=s,s},void 0===(r=n.call(t,i,t,e))||(e.exports=r)}()},452:e=>{var t=function(e){"use strict";var t,i=Object.prototype,n=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,i){return e[t]=i}}function d(e,t,i,n){var r=t&&t.prototype instanceof m?t:m,s=Object.create(r.prototype),o=new E(n||[]);return s._invoke=function(e,t,i){var n=u;return function(r,s){if(n===g)throw new Error("Generator is already running");if(n===p){if("throw"===r)throw s;return R()}for(i.method=r,i.arg=s;;){var o=i.delegate;if(o){var a=I(o,i);if(a){if(a===w)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===u)throw n=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=g;var c=l(e,t,i);if("normal"===c.type){if(n=i.done?p:h,c.arg===w)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n=p,i.method="throw",i.arg=c.arg)}}}(e,i,o),s}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var u="suspendedStart",h="suspendedYield",g="executing",p="completed",w={};function m(){}function f(){}function _(){}var v={};c(v,s,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(x([])));b&&b!==i&&n.call(b,s)&&(v=b);var S=_.prototype=m.prototype=Object.create(v);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function i(r,s,o,a){var c=l(e[r],e,s);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,o,a)}),(function(e){i("throw",e,o,a)})):t.resolve(u).then((function(e){d.value=e,o(d)}),(function(e){return i("throw",e,o,a)}))}a(c.arg)}var r;this._invoke=function(e,n){function s(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(s,s):s()}}function I(e,i){var n=e.iterator[i.method];if(n===t){if(i.delegate=null,"throw"===i.method){if(e.iterator.return&&(i.method="return",i.arg=t,I(e,i),"throw"===i.method))return w;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return w}var r=l(n,e.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,w;var s=r.arg;return s?s.done?(i[e.resultName]=s.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,w):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,w)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function x(e){if(e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function i(){for(;++r<e.length;)if(n.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}return{next:R}}function R(){return{value:t,done:!0}}return f.prototype=_,c(S,"constructor",_),c(_,"constructor",f),f.displayName=c(_,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,a,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},C(k.prototype),c(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(t,i,n,r,s){void 0===s&&(s=Promise);var o=new k(d(t,i,n,r),s);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(S),c(S,a,"Generator"),c(S,s,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var n=t.pop();if(n in e)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=x,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(n,r){return a.type="throw",a.arg=e,i.next=n,r&&(i.method="next",i.arg=t),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),d=n.call(o,"finallyLoc");if(c&&d){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,w):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;P(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,n){return this.delegate={iterator:x(e),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=t),w}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},74:(e,t,i)=>{var n=i(72),r=i(353);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.id,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},47:(e,t,i)=>{var n=i(72),r=i(936);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.id,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},72:(e,t,i)=>{"use strict";var n,r=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),s=[];function o(e){for(var t=-1,i=0;i<s.length;i++)if(s[i].identifier===e){t=i;break}return t}function a(e,t){for(var i={},n=[],r=0;r<e.length;r++){var a=e[r],c=t.base?a[0]+t.base:a[0],d=i[c]||0,l="".concat(c," ").concat(d);i[c]=d+1;var u=o(l),h={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(s[u].references++,s[u].updater(h)):s.push({identifier:l,updater:w(h,t),references:1}),n.push(l)}return n}function c(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var s=i.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var o=r(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var d,l=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function u(e,t,i,n){var r=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=l(t,r);else{var s=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function h(e,t,i){var n=i.css,r=i.media,s=i.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var g=null,p=0;function w(e,t){var i,n,r;if(t.singleton){var s=p++;i=g||(g=c(t)),n=u.bind(null,i,s,!1),r=u.bind(null,i,s,!0)}else i=c(t),n=h.bind(null,i,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var i=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<i.length;n++){var r=o(i[n]);s[r].references--}for(var c=a(e,t),d=0;d<i.length;d++){var l=o(i[d]);0===s[l].references&&(s[l].updater(),s.splice(l,1))}i=c}}}},477:()=>{},625:(e,t,i)=>{"use strict";i.d(t,{$5:()=>se,KJ:()=>$,O:()=>P,hz:()=>F});var n,r,s,o=i(21),a=i(9),c=i(754),d=i(178),l=i(765),u={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},h=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(h||{});(s=h||(h={})).reset=function(){n=3,r=u},s.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");n=e},s.setLogger=function(e){r=e};var g=class{constructor(e){this._name=e}debug(...e){n>=4&&r.debug(g._format(this._name,this._method),...e)}info(...e){n>=3&&r.info(g._format(this._name,this._method),...e)}warn(...e){n>=2&&r.warn(g._format(this._name,this._method),...e)}error(...e){n>=1&&r.error(g._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(e,t){const i=new g(`${e}.${t}`);return i.debug("begin"),i}static _format(e,t){const i=`[${e}]`;return t?`${i} ${t}:`:i}static debug(e,...t){n>=4&&r.debug(g._format(e),...t)}static info(e,...t){n>=3&&r.info(g._format(e),...t)}static warn(e,...t){n>=2&&r.warn(g._format(e),...t)}static error(e,...t){n>=1&&r.error(g._format(e),...t)}};h.reset();var p=class{static _randomWord(){return o.lib.WordArray.random(1).words[0]}static generateUUIDv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^p._randomWord()&15>>+e/4).toString(16))).replace(/-/g,"")}static generateCodeVerifier(){return p.generateUUIDv4()+p.generateUUIDv4()+p.generateUUIDv4()}static generateCodeChallenge(e){try{const t=a(e);return c.stringify(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(e){throw g.error("CryptoUtils.generateCodeChallenge",e),e}}static generateBasicAuth(e,t){const i=d.parse([e,t].join(":"));return c.stringify(i)}},w=class{constructor(e){this._name=e,this._logger=new g(`Event('${this._name}')`),this._callbacks=[]}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)t(...e)}},m=class{static decode(e){try{return(0,l.A)(e)}catch(e){throw g.error("JwtUtils.decode",e),e}}},f=class{static center({...e}){var t;return null==e.width&&(e.width=null!=(t=[800,720,600,480].find((e=>e<=window.outerWidth/1.618)))?t:360),null!=e.left||(e.left=Math.max(0,Math.round(window.screenX+(window.outerWidth-e.width)/2))),null!=e.height&&(null!=e.top||(e.top=Math.max(0,Math.round(window.screenY+(window.outerHeight-e.height)/2)))),e}static serialize(e){return Object.entries(e).filter((([,e])=>null!=e)).map((([e,t])=>`${e}=${"boolean"!=typeof t?t:t?"yes":"no"}`)).join(",")}},_=class extends w{constructor(){super(...arguments),this._logger=new g(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-_.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=_.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const t=this._logger.create("init");e=Math.max(Math.floor(e),1);const i=_.getEpochTime()+e;if(this.expiration===i&&this._timerHandle)return void t.debug("skipping since already initialized for expiration at",this.expiration);this.cancel(),t.debug("using duration",e),this._expiration=i;const n=Math.min(e,5);this._timerHandle=setInterval(this._callback,1e3*n)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},v=class{static readParams(e,t="query"){if(!e)throw new TypeError("Invalid URL");const i=new URL(e,window.location.origin)["fragment"===t?"hash":"search"];return new URLSearchParams(i.slice(1))}},y=class extends Error{constructor(e,t){var i,n,r;if(super(e.error_description||e.error||""),this.form=t,this.name="ErrorResponse",!e.error)throw g.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=e.error,this.error_description=null!=(i=e.error_description)?i:null,this.error_uri=null!=(n=e.error_uri)?n:null,this.state=e.userState,this.session_state=null!=(r=e.session_state)?r:null}},b=class extends Error{constructor(e){super(e),this.name="ErrorTimeout"}},S=class{constructor(e){this._logger=new g("AccessTokenEvents"),this._expiringTimer=new _("Access token expiring"),this._expiredTimer=new _("Access token expired"),this._expiringNotificationTimeInSeconds=e.expiringNotificationTimeInSeconds}load(e){const t=this._logger.create("load");if(e.access_token&&void 0!==e.expires_in){const i=e.expires_in;if(t.debug("access token present, remaining duration:",i),i>0){let e=i-this._expiringNotificationTimeInSeconds;e<=0&&(e=1),t.debug("registering expiring timer, raising in",e,"seconds"),this._expiringTimer.init(e)}else t.debug("canceling existing expiring timer because we're past expiration."),this._expiringTimer.cancel();const n=i+1;t.debug("registering expired timer, raising in",n,"seconds"),this._expiredTimer.init(n)}else this._expiringTimer.cancel(),this._expiredTimer.cancel()}unload(){this._logger.debug("unload: canceling existing access token timers"),this._expiringTimer.cancel(),this._expiredTimer.cancel()}addAccessTokenExpiring(e){return this._expiringTimer.addHandler(e)}removeAccessTokenExpiring(e){this._expiringTimer.removeHandler(e)}addAccessTokenExpired(e){return this._expiredTimer.addHandler(e)}removeAccessTokenExpired(e){this._expiredTimer.removeHandler(e)}},C=class{constructor(e,t,i,n,r){this._callback=e,this._client_id=t,this._intervalInSeconds=n,this._stopOnError=r,this._logger=new g("CheckSessionIFrame"),this._timer=null,this._session_state=null,this._message=e=>{e.origin===this._frame_origin&&e.source===this._frame.contentWindow&&("error"===e.data?(this._logger.error("error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===e.data?(this._logger.debug("changed message from check session op iframe"),this.stop(),this._callback()):this._logger.debug(e.data+" message from check session op iframe"))};const s=new URL(i);this._frame_origin=s.origin,this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="fixed",this._frame.style.left="-1000px",this._frame.style.top="0",this._frame.width="0",this._frame.height="0",this._frame.src=s.href}load(){return new Promise((e=>{this._frame.onload=()=>{e()},window.document.body.appendChild(this._frame),window.addEventListener("message",this._message,!1)}))}start(e){if(this._session_state===e)return;this._logger.create("start"),this.stop(),this._session_state=e;const t=()=>{this._frame.contentWindow&&this._session_state&&this._frame.contentWindow.postMessage(this._client_id+" "+this._session_state,this._frame_origin)};t(),this._timer=setInterval(t,1e3*this._intervalInSeconds)}stop(){this._logger.create("stop"),this._session_state=null,this._timer&&(clearInterval(this._timer),this._timer=null)}},k=class{constructor(){this._logger=new g("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(e){return this._logger.create(`getItem('${e}')`),this._data[e]}setItem(e,t){this._logger.create(`setItem('${e}')`),this._data[e]=t}removeItem(e){this._logger.create(`removeItem('${e}')`),delete this._data[e]}get length(){return Object.getOwnPropertyNames(this._data).length}key(e){return Object.getOwnPropertyNames(this._data)[e]}},I=class{constructor(e=[],t=null){this._jwtHandler=t,this._logger=new g("JsonService"),this._contentTypes=[],this._contentTypes.push(...e,"application/json"),t&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(e,t={}){const{timeoutInSeconds:i,...n}=t;if(!i)return await fetch(e,n);const r=new AbortController,s=setTimeout((()=>r.abort()),1e3*i);try{return await fetch(e,{...t,signal:r.signal})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)throw new b("Network timed out");throw e}finally{clearTimeout(s)}}async getJson(e,{token:t,credentials:i}={}){const n=this._logger.create("getJson"),r={Accept:this._contentTypes.join(", ")};let s;t&&(n.debug("token passed, setting Authorization header"),r.Authorization="Bearer "+t);try{n.debug("url:",e),s=await this.fetchWithTimeout(e,{method:"GET",headers:r,credentials:i})}catch(e){throw n.error("Network Error"),e}n.debug("HTTP response received, status",s.status);const o=s.headers.get("Content-Type");if(o&&!this._contentTypes.find((e=>o.startsWith(e)))&&n.throw(new Error(`Invalid response Content-Type: ${null!=o?o:"undefined"}, from URL: ${e}`)),s.ok&&this._jwtHandler&&(null==o?void 0:o.startsWith("application/jwt")))return await this._jwtHandler(await s.text());let a;try{a=await s.json()}catch(e){if(n.error("Error parsing JSON response",e),s.ok)throw e;throw new Error(`${s.statusText} (${s.status})`)}if(!s.ok){if(n.error("Error from server:",a),a.error)throw new y(a);throw new Error(`${s.statusText} (${s.status}): ${JSON.stringify(a)}`)}return a}async postForm(e,{body:t,basicAuth:i,timeoutInSeconds:n,initCredentials:r}){const s=this._logger.create("postForm"),o={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded"};let a;void 0!==i&&(o.Authorization="Basic "+i);try{s.debug("url:",e),a=await this.fetchWithTimeout(e,{method:"POST",headers:o,body:t,timeoutInSeconds:n,credentials:r})}catch(e){throw s.error("Network error"),e}s.debug("HTTP response received, status",a.status);const c=a.headers.get("Content-Type");if(c&&!this._contentTypes.find((e=>c.startsWith(e))))throw new Error(`Invalid response Content-Type: ${null!=c?c:"undefined"}, from URL: ${e}`);const d=await a.text();let l={};if(d)try{l=JSON.parse(d)}catch(e){if(s.error("Error parsing JSON response",e),a.ok)throw e;throw new Error(`${a.statusText} (${a.status})`)}if(!a.ok){if(s.error("Error from server:",l),l.error)throw new y(l,t);throw new Error(`${a.statusText} (${a.status}): ${JSON.stringify(l)}`)}return l}},T=class{constructor(e){this._settings=e,this._logger=new g("MetadataService"),this._jsonService=new I(["application/jwk-set+json"]),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const e=this._logger.create("getMetadata");if(this._metadata)return e.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw e.throw(new Error("No authority or metadataUrl configured on settings")),null;e.debug("getting metadata from",this._metadataUrl);const t=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials});return e.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,t),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(e=!0){return this._getMetadataProperty("token_endpoint",e)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(e=!0){return this._getMetadataProperty("revocation_endpoint",e)}getKeysEndpoint(e=!0){return this._getMetadataProperty("jwks_uri",e)}async _getMetadataProperty(e,t=!1){const i=this._logger.create(`_getMetadataProperty('${e}')`),n=await this.getMetadata();if(i.debug("resolved"),void 0===n[e]){if(!0===t)return void i.warn("Metadata does not contain optional property");i.throw(new Error("Metadata does not contain property "+e))}return n[e]}async getSigningKeys(){const e=this._logger.create("getSigningKeys");if(this._signingKeys)return e.debug("returning signingKeys from cache"),this._signingKeys;const t=await this.getKeysEndpoint(!1);e.debug("got jwks_uri",t);const i=await this._jsonService.getJson(t);if(e.debug("got key set",i),!Array.isArray(i.keys))throw e.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=i.keys,this._signingKeys}},P=class{constructor({prefix:e="oidc.",store:t=localStorage}={}){this._logger=new g("WebStorageStateStore"),this._store=t,this._prefix=e}async set(e,t){this._logger.create(`set('${e}')`),e=this._prefix+e,await this._store.setItem(e,t)}async get(e){return this._logger.create(`get('${e}')`),e=this._prefix+e,await this._store.getItem(e)}async remove(e){this._logger.create(`remove('${e}')`),e=this._prefix+e;const t=await this._store.getItem(e);return await this._store.removeItem(e),t}async getAllKeys(){this._logger.create("getAllKeys");const e=await this._store.length,t=[];for(let i=0;i<e;i++){const e=await this._store.key(i);e&&0===e.indexOf(this._prefix)&&t.push(e.substr(this._prefix.length))}return t}},E=class{constructor({authority:e,metadataUrl:t,metadata:i,signingKeys:n,metadataSeed:r,client_id:s,client_secret:o,response_type:a="code",scope:c="openid",redirect_uri:d,post_logout_redirect_uri:l,client_authentication:u="client_secret_post",prompt:h,display:g,max_age:p,ui_locales:w,acr_values:m,resource:f,response_mode:_="query",filterProtocolClaims:v=!0,loadUserInfo:y=!1,staleStateAgeInSeconds:b=900,clockSkewInSeconds:S=300,userInfoJwtIssuer:C="OP",mergeClaims:I=!1,disablePKCE:T=!1,stateStore:E,refreshTokenCredentials:x,revokeTokenAdditionalContentTypes:R,fetchRequestCredentials:O,refreshTokenAllowedScope:A,extraQueryParams:U={},extraTokenParams:L={}}){if(this.authority=e,t?this.metadataUrl=t:(this.metadataUrl=e,e&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=i,this.metadataSeed=r,this.signingKeys=n,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=c,this.redirect_uri=d,this.post_logout_redirect_uri=l,this.client_authentication=u,this.prompt=h,this.display=g,this.max_age=p,this.ui_locales=w,this.acr_values=m,this.resource=f,this.response_mode=_,this.filterProtocolClaims=null==v||v,this.loadUserInfo=!!y,this.staleStateAgeInSeconds=b,this.clockSkewInSeconds=S,this.userInfoJwtIssuer=C,this.mergeClaims=!!I,this.disablePKCE=!!T,this.revokeTokenAdditionalContentTypes=R,O&&x&&console.warn("Both fetchRequestCredentials and refreshTokenCredentials is set. Only fetchRequestCredentials will be used."),this.fetchRequestCredentials=O||x||"same-origin",E)this.stateStore=E;else{const e="undefined"!=typeof window?window.localStorage:new k;this.stateStore=new P({store:e})}this.refreshTokenAllowedScope=A,this.extraQueryParams=U,this.extraTokenParams=L}},x=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new g("UserInfoService"),this._getClaimsFromJwt=async e=>{const t=this._logger.create("_getClaimsFromJwt");try{const i=m.decode(e);return t.debug("JWT decoding successful"),i}catch(e){throw t.error("Error parsing JWT response"),e}},this._jsonService=new I(void 0,this._getClaimsFromJwt)}async getClaims(e){const t=this._logger.create("getClaims");e||this._logger.throw(new Error("No token passed"));const i=await this._metadataService.getUserInfoEndpoint();t.debug("got userinfo url",i);const n=await this._jsonService.getJson(i,{token:e,credentials:this._settings.fetchRequestCredentials});return t.debug("got claims",n),n}},R=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new g("TokenClient"),this._jsonService=new I(this._settings.revokeTokenAdditionalContentTypes)}async exchangeCode({grant_type:e="authorization_code",redirect_uri:t=this._settings.redirect_uri,client_id:i=this._settings.client_id,client_secret:n=this._settings.client_secret,...r}){const s=this._logger.create("exchangeCode");i||s.throw(new Error("A client_id is required")),t||s.throw(new Error("A redirect_uri is required")),r.code||s.throw(new Error("A code is required"));const o=new URLSearchParams({grant_type:e,redirect_uri:t});for(const[e,t]of Object.entries(r))null!=t&&o.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=p.generateBasicAuth(i,n);break;case"client_secret_post":o.append("client_id",i),n&&o.append("client_secret",n)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const d=await this._jsonService.postForm(c,{body:o,basicAuth:a,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),d}async exchangeCredentials({grant_type:e="password",client_id:t=this._settings.client_id,client_secret:i=this._settings.client_secret,scope:n=this._settings.scope,...r}){const s=this._logger.create("exchangeCredentials");t||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:e,scope:n});for(const[e,t]of Object.entries(r))null!=t&&o.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!i)throw s.throw(new Error("A client_secret is required")),null;a=p.generateBasicAuth(t,i);break;case"client_secret_post":o.append("client_id",t),i&&o.append("client_secret",i)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const d=await this._jsonService.postForm(c,{body:o,basicAuth:a,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),d}async exchangeRefreshToken({grant_type:e="refresh_token",client_id:t=this._settings.client_id,client_secret:i=this._settings.client_secret,timeoutInSeconds:n,...r}){const s=this._logger.create("exchangeRefreshToken");t||s.throw(new Error("A client_id is required")),r.refresh_token||s.throw(new Error("A refresh_token is required"));const o=new URLSearchParams({grant_type:e});for(const[e,t]of Object.entries(r))null!=t&&o.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!i)throw s.throw(new Error("A client_secret is required")),null;a=p.generateBasicAuth(t,i);break;case"client_secret_post":o.append("client_id",t),i&&o.append("client_secret",i)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const d=await this._jsonService.postForm(c,{body:o,basicAuth:a,timeoutInSeconds:n,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),d}async revoke(e){var t;const i=this._logger.create("revoke");e.token||i.throw(new Error("A token is required"));const n=await this._metadataService.getRevocationEndpoint(!1);i.debug(`got revocation endpoint, revoking ${null!=(t=e.token_type_hint)?t:"default token type"}`);const r=new URLSearchParams;for(const[t,i]of Object.entries(e))null!=i&&r.set(t,i);r.set("client_id",this._settings.client_id),this._settings.client_secret&&r.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(n,{body:r}),i.debug("got response")}},O=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],A=["sub","iss","aud","exp","iat"],U=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new g("ResponseValidator"),this._userInfoService=new x(this._settings,this._metadataService),this._tokenClient=new R(this._settings,this._metadataService)}async validateSigninResponse(e,t){const i=this._logger.create("validateSigninResponse");this._processSigninState(e,t),i.debug("state processed"),await this._processCode(e,t),i.debug("code processed"),e.isOpenId&&this._validateIdTokenAttributes(e),i.debug("tokens validated"),await this._processClaims(e,null==t?void 0:t.skipUserInfo,e.isOpenId),i.debug("claims processed")}async validateCredentialsResponse(e,t){const i=this._logger.create("validateCredentialsResponse");e.isOpenId&&this._validateIdTokenAttributes(e),i.debug("tokens validated"),await this._processClaims(e,t,e.isOpenId),i.debug("claims processed")}async validateRefreshResponse(e,t){const i=this._logger.create("validateRefreshResponse");e.userState=t.data,null!=e.session_state||(e.session_state=t.session_state),null!=e.scope||(e.scope=t.scope),e.isOpenId&&e.id_token&&(this._validateIdTokenAttributes(e,t.id_token),i.debug("ID Token validated")),e.id_token||(e.id_token=t.id_token,e.profile=t.profile);const n=e.isOpenId&&!!e.id_token;await this._processClaims(e,!1,n),i.debug("claims processed")}validateSignoutResponse(e,t){const i=this._logger.create("validateSignoutResponse");if(t.id!==e.state&&i.throw(new Error("State does not match")),i.debug("state validated"),e.userState=t.data,e.error)throw i.warn("Response was error",e.error),new y(e)}_processSigninState(e,t){const i=this._logger.create("_processSigninState");if(t.id!==e.state&&i.throw(new Error("State does not match")),t.client_id||i.throw(new Error("No client_id on state")),t.authority||i.throw(new Error("No authority on state")),this._settings.authority!==t.authority&&i.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==t.client_id&&i.throw(new Error("client_id mismatch on settings vs. signin state")),i.debug("state validated"),e.userState=t.data,null!=e.scope||(e.scope=t.scope),e.error)throw i.warn("Response was error",e.error),new y(e);t.code_verifier&&!e.code&&i.throw(new Error("Expected code in response"))}async _processClaims(e,t=!1,i=!0){const n=this._logger.create("_processClaims");if(e.profile=this._filterProtocolClaims(e.profile),t||!this._settings.loadUserInfo||!e.access_token)return void n.debug("not loading user info");n.debug("loading user info");const r=await this._userInfoService.getClaims(e.access_token);n.debug("user info claims received from user info endpoint"),i&&r.sub!==e.profile.sub&&n.throw(new Error("subject from UserInfo response does not match subject in ID Token")),e.profile=this._mergeClaims(e.profile,this._filterProtocolClaims(r)),n.debug("user info claims received, updated profile:",e.profile)}_mergeClaims(e,t){const i={...e};for(const[e,n]of Object.entries(t))for(const t of Array.isArray(n)?n:[n]){const n=i[e];n?Array.isArray(n)?n.includes(t)||n.push(t):i[e]!==t&&("object"==typeof t&&this._settings.mergeClaims?i[e]=this._mergeClaims(n,t):i[e]=[n,t]):i[e]=t}return i}_filterProtocolClaims(e){const t={...e};if(this._settings.filterProtocolClaims){let e;e=Array.isArray(this._settings.filterProtocolClaims)?this._settings.filterProtocolClaims:O;for(const i of e)A.includes(i)||delete t[i]}return t}async _processCode(e,t){const i=this._logger.create("_processCode");if(e.code){i.debug("Validating code");const n=await this._tokenClient.exchangeCode({client_id:t.client_id,client_secret:t.client_secret,code:e.code,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier,...t.extraTokenParams});Object.assign(e,n)}else i.debug("No code to process")}_validateIdTokenAttributes(e,t){var i;const n=this._logger.create("_validateIdTokenAttributes");n.debug("decoding ID Token JWT");const r=m.decode(null!=(i=e.id_token)?i:"");if(r.sub||n.throw(new Error("ID Token is missing a subject claim")),t){const e=m.decode(t);e.sub!==r.sub&&n.throw(new Error("sub in id_token does not match current sub")),e.auth_time&&e.auth_time!==r.auth_time&&n.throw(new Error("auth_time in id_token does not match original auth_time")),e.azp&&e.azp!==r.azp&&n.throw(new Error("azp in id_token does not match original azp")),!e.azp&&r.azp&&n.throw(new Error("azp not in id_token, but present in original id_token"))}e.profile=r}},L=class{constructor(e){this.id=e.id||p.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=_.getEpochTime(),this.request_type=e.request_type}toStorageString(){return new g("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})}static fromStorageString(e){return g.createStatic("State","fromStorageString"),new L(JSON.parse(e))}static async clearStaleState(e,t){const i=g.createStatic("State","clearStaleState"),n=_.getEpochTime()-t,r=await e.getAllKeys();i.debug("got keys",r);for(let t=0;t<r.length;t++){const s=r[t],o=await e.get(s);let a=!1;if(o)try{const e=L.fromStorageString(o);i.debug("got item from key:",s,e.created),e.created<=n&&(a=!0)}catch(e){i.error("Error parsing state for key:",s,e),a=!0}else i.debug("no item in storage for key:",s),a=!0;a&&(i.debug("removed item for key:",s),e.remove(s))}}},M=class extends L{constructor(e){super(e),!0===e.code_verifier?this.code_verifier=p.generateCodeVerifier():e.code_verifier&&(this.code_verifier=e.code_verifier),this.code_verifier&&(this.code_challenge=p.generateCodeChallenge(this.code_verifier)),this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}toStorageString(){return new g("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){g.createStatic("SigninState","fromStorageString");const t=JSON.parse(e);return new M(t)}},N=class{constructor({url:e,authority:t,client_id:i,redirect_uri:n,response_type:r,scope:s,state_data:o,response_mode:a,request_type:c,client_secret:d,nonce:l,resource:u,skipUserInfo:h,extraQueryParams:p,extraTokenParams:w,disablePKCE:m,...f}){if(this._logger=new g("SigninRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");if(!i)throw this._logger.error("ctor: No client_id passed"),new Error("client_id");if(!n)throw this._logger.error("ctor: No redirect_uri passed"),new Error("redirect_uri");if(!r)throw this._logger.error("ctor: No response_type passed"),new Error("response_type");if(!s)throw this._logger.error("ctor: No scope passed"),new Error("scope");if(!t)throw this._logger.error("ctor: No authority passed"),new Error("authority");this.state=new M({data:o,request_type:c,code_verifier:!m,client_id:i,authority:t,redirect_uri:n,response_mode:a,client_secret:d,scope:s,extraTokenParams:w,skipUserInfo:h});const _=new URL(e);_.searchParams.append("client_id",i),_.searchParams.append("redirect_uri",n),_.searchParams.append("response_type",r),_.searchParams.append("scope",s),l&&_.searchParams.append("nonce",l),_.searchParams.append("state",this.state.id),this.state.code_challenge&&(_.searchParams.append("code_challenge",this.state.code_challenge),_.searchParams.append("code_challenge_method","S256")),u&&(Array.isArray(u)?u:[u]).forEach((e=>_.searchParams.append("resource",e)));for(const[e,t]of Object.entries({response_mode:a,...f,...p}))null!=t&&_.searchParams.append(e,t.toString());this.url=_.href}},q=class{constructor(e){this.access_token="",this.token_type="",this.profile={},this.state=e.get("state"),this.session_state=e.get("session_state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri"),this.code=e.get("code")}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-_.getEpochTime()}set expires_in(e){"string"==typeof e&&(e=Number(e)),void 0!==e&&e>=0&&(this.expires_at=Math.floor(e)+_.getEpochTime())}get isOpenId(){var e;return(null==(e=this.scope)?void 0:e.split(" ").includes("openid"))||!!this.id_token}},j=class{constructor({url:e,state_data:t,id_token_hint:i,post_logout_redirect_uri:n,extraQueryParams:r,request_type:s}){if(this._logger=new g("SignoutRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");const o=new URL(e);i&&o.searchParams.append("id_token_hint",i),n&&(o.searchParams.append("post_logout_redirect_uri",n),t&&(this.state=new L({data:t,request_type:s}),o.searchParams.append("state",this.state.id)));for(const[e,t]of Object.entries({...r}))null!=t&&o.searchParams.append(e,t.toString());this.url=o.href}},B=class{constructor(e){this.state=e.get("state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri")}},F=class{constructor(e){this._logger=new g("OidcClient"),this.settings=new E(e),this.metadataService=new T(this.settings),this._validator=new U(this.settings,this.metadataService),this._tokenClient=new R(this.settings,this.metadataService)}async createSigninRequest({state:e,request:t,request_uri:i,request_type:n,id_token_hint:r,login_hint:s,skipUserInfo:o,nonce:a,response_type:c=this.settings.response_type,scope:d=this.settings.scope,redirect_uri:l=this.settings.redirect_uri,prompt:u=this.settings.prompt,display:h=this.settings.display,max_age:g=this.settings.max_age,ui_locales:p=this.settings.ui_locales,acr_values:w=this.settings.acr_values,resource:m=this.settings.resource,response_mode:f=this.settings.response_mode,extraQueryParams:_=this.settings.extraQueryParams,extraTokenParams:v=this.settings.extraTokenParams}){const y=this._logger.create("createSigninRequest");if("code"!==c)throw new Error("Only the Authorization Code flow (with PKCE) is supported");const b=await this.metadataService.getAuthorizationEndpoint();y.debug("Received authorization endpoint",b);const S=new N({url:b,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:l,response_type:c,scope:d,state_data:e,prompt:u,display:h,max_age:g,ui_locales:p,id_token_hint:r,login_hint:s,acr_values:w,resource:m,request:t,request_uri:i,extraQueryParams:_,extraTokenParams:v,request_type:n,response_mode:f,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE});await this.clearStaleState();const C=S.state;return await this.settings.stateStore.set(C.id,C.toStorageString()),S}async readSigninResponseState(e,t=!1){const i=this._logger.create("readSigninResponseState"),n=new q(v.readParams(e,this.settings.response_mode));if(!n.state)throw i.throw(new Error("No state in response")),null;const r=await this.settings.stateStore[t?"remove":"get"](n.state);if(!r)throw i.throw(new Error("No matching state found in storage")),null;return{state:M.fromStorageString(r),response:n}}async processSigninResponse(e){const t=this._logger.create("processSigninResponse"),{state:i,response:n}=await this.readSigninResponseState(e,!0);return t.debug("received state from storage; validating response"),await this._validator.validateSigninResponse(n,i),n}async processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:i=!1,extraTokenParams:n={}}){const r=await this._tokenClient.exchangeCredentials({username:e,password:t,...n}),s=new q(new URLSearchParams);return Object.assign(s,r),await this._validator.validateCredentialsResponse(s,i),s}async useRefreshToken({state:e,timeoutInSeconds:t}){var i;const n=this._logger.create("useRefreshToken");let r;if(void 0===this.settings.refreshTokenAllowedScope)r=e.scope;else{const t=this.settings.refreshTokenAllowedScope.split(" ");r=((null==(i=e.scope)?void 0:i.split(" "))||[]).filter((e=>t.includes(e))).join(" ")}const s=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:r,timeoutInSeconds:t}),o=new q(new URLSearchParams);return Object.assign(o,s),n.debug("validating response",o),await this._validator.validateRefreshResponse(o,{...e,scope:r}),o}async createSignoutRequest({state:e,id_token_hint:t,request_type:i,post_logout_redirect_uri:n=this.settings.post_logout_redirect_uri,extraQueryParams:r=this.settings.extraQueryParams}={}){const s=this._logger.create("createSignoutRequest"),o=await this.metadataService.getEndSessionEndpoint();if(!o)throw s.throw(new Error("No end session endpoint")),null;s.debug("Received end session endpoint",o);const a=new j({url:o,id_token_hint:t,post_logout_redirect_uri:n,state_data:e,extraQueryParams:r,request_type:i});await this.clearStaleState();const c=a.state;return c&&(s.debug("Signout request has state to persist"),await this.settings.stateStore.set(c.id,c.toStorageString())),a}async readSignoutResponseState(e,t=!1){const i=this._logger.create("readSignoutResponseState"),n=new B(v.readParams(e,this.settings.response_mode));if(!n.state){if(i.debug("No state in response"),n.error)throw i.warn("Response was error:",n.error),new y(n);return{state:void 0,response:n}}const r=await this.settings.stateStore[t?"remove":"get"](n.state);if(!r)throw i.throw(new Error("No matching state found in storage")),null;return{state:L.fromStorageString(r),response:n}}async processSignoutResponse(e){const t=this._logger.create("processSignoutResponse"),{state:i,response:n}=await this.readSignoutResponseState(e,!0);return i?(t.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(n,i)):t.debug("No state from storage; skipping response validation"),n}clearStaleState(){return this._logger.create("clearStaleState"),L.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(e,t){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:e,token_type_hint:t})}},H=class{constructor(e){this._userManager=e,this._logger=new g("SessionMonitor"),this._start=async e=>{const t=e.session_state;if(!t)return;const i=this._logger.create("_start");if(e.profile?(this._sub=e.profile.sub,this._sid=e.profile.sid,i.debug("session_state",t,", sub",this._sub)):(this._sub=void 0,this._sid=void 0,i.debug("session_state",t,", anonymous user")),this._checkSessionIFrame)this._checkSessionIFrame.start(t);else try{const e=await this._userManager.metadataService.getCheckSessionIframe();if(e){i.debug("initializing check session iframe");const n=this._userManager.settings.client_id,r=this._userManager.settings.checkSessionIntervalInSeconds,s=this._userManager.settings.stopCheckSessionOnError,o=new C(this._callback,n,e,r,s);await o.load(),this._checkSessionIFrame=o,o.start(t)}else i.warn("no check session iframe found in the metadata")}catch(e){i.error("Error from getCheckSessionIframe:",e instanceof Error?e.message:e)}},this._stop=()=>{const e=this._logger.create("_stop");if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&this._checkSessionIFrame.stop(),this._userManager.settings.monitorAnonymousSession){const t=setInterval((async()=>{clearInterval(t);try{const e=await this._userManager.querySessionStatus();if(e){const t={session_state:e.session_state,profile:e.sub&&e.sid?{sub:e.sub,sid:e.sid}:null};this._start(t)}}catch(t){e.error("error from querySessionStatus",t instanceof Error?t.message:t)}}),1e3)}},this._callback=async()=>{const e=this._logger.create("_callback");try{const t=await this._userManager.querySessionStatus();let i=!0;t&&this._checkSessionIFrame?t.sub===this._sub?(i=!1,this._checkSessionIFrame.start(t.session_state),t.sid===this._sid?e.debug("same sub still logged in at OP, restarting check session iframe; session_state",t.session_state):(e.debug("same sub still logged in at OP, session state has changed, restarting check session iframe; session_state",t.session_state),this._userManager.events._raiseUserSessionChanged())):e.debug("different subject signed into OP",t.sub):e.debug("subject no longer signed into OP"),i?this._sub?this._userManager.events._raiseUserSignedOut():this._userManager.events._raiseUserSignedIn():e.debug("no change in session detected, no event to raise")}catch(t){this._sub&&(e.debug("Error calling queryCurrentSigninSession; raising signed out event",t),this._userManager.events._raiseUserSignedOut())}},e||this._logger.throw(new Error("No user manager passed")),this._userManager.events.addUserLoaded(this._start),this._userManager.events.addUserUnloaded(this._stop),this._init().catch((e=>{this._logger.error(e)}))}async _init(){this._logger.create("_init");const e=await this._userManager.getUser();if(e)this._start(e);else if(this._userManager.settings.monitorAnonymousSession){const e=await this._userManager.querySessionStatus();if(e){const t={session_state:e.session_state,profile:e.sub&&e.sid?{sub:e.sub,sid:e.sid}:null};this._start(t)}}}},$=class{constructor(e){var t;this.id_token=e.id_token,this.session_state=null!=(t=e.session_state)?t:null,this.access_token=e.access_token,this.refresh_token=e.refresh_token,this.token_type=e.token_type,this.scope=e.scope,this.profile=e.profile,this.expires_at=e.expires_at,this.state=e.userState}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-_.getEpochTime()}set expires_in(e){void 0!==e&&(this.expires_at=Math.floor(e)+_.getEpochTime())}get expired(){const e=this.expires_in;if(void 0!==e)return e<=0}get scopes(){var e,t;return null!=(t=null==(e=this.scope)?void 0:e.split(" "))?t:[]}toStorageString(){return new g("User").create("toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}static fromStorageString(e){return g.createStatic("User","fromStorageString"),new $(JSON.parse(e))}},W="oidc-client",D=class{constructor(){this._abort=new w("Window navigation aborted"),this._disposeHandlers=new Set,this._window=null}async navigate(e){const t=this._logger.create("navigate");if(!this._window)throw new Error("Attempted to navigate on a disposed window");t.debug("setting URL in window"),this._window.location.replace(e.url);const{url:i,keepOpen:n}=await new Promise(((i,n)=>{const r=r=>{var s;const o=r.data,a=null!=(s=e.scriptOrigin)?s:window.location.origin;if(r.origin===a&&(null==o?void 0:o.source)===W){try{const i=v.readParams(o.url,e.response_mode).get("state");if(i||t.warn("no state found in response url"),r.source!==this._window&&i!==e.state)return}catch(e){this._dispose(),n(new Error("Invalid response from window"))}i(o)}};window.addEventListener("message",r,!1),this._disposeHandlers.add((()=>window.removeEventListener("message",r,!1))),this._disposeHandlers.add(this._abort.addHandler((e=>{this._dispose(),n(e)})))}));return t.debug("got response from window"),this._dispose(),n||this.close(),{url:i}}_dispose(){this._logger.create("_dispose");for(const e of this._disposeHandlers)e();this._disposeHandlers.clear()}static _notifyParent(e,t,i=!1,n=window.location.origin){e.postMessage({source:W,url:t,keepOpen:i},n)}},z={location:!1,toolbar:!1,height:640},K="_blank",G=60,Q=2,J=10,V=class extends E{constructor(e){const{popup_redirect_uri:t=e.redirect_uri,popup_post_logout_redirect_uri:i=e.post_logout_redirect_uri,popupWindowFeatures:n=z,popupWindowTarget:r=K,redirectMethod:s="assign",redirectTarget:o="self",iframeNotifyParentOrigin:a=e.iframeNotifyParentOrigin,iframeScriptOrigin:c=e.iframeScriptOrigin,silent_redirect_uri:d=e.redirect_uri,silentRequestTimeoutInSeconds:l=J,automaticSilentRenew:u=!0,validateSubOnSilentRenew:h=!0,includeIdTokenInSilentRenew:g=!1,monitorSession:p=!1,monitorAnonymousSession:w=!1,checkSessionIntervalInSeconds:m=Q,query_status_response_type:f="code",stopCheckSessionOnError:_=!0,revokeTokenTypes:v=["access_token","refresh_token"],revokeTokensOnSignout:y=!1,includeIdTokenInSilentSignout:b=!1,accessTokenExpiringNotificationTimeInSeconds:S=G,userStore:C}=e;if(super(e),this.popup_redirect_uri=t,this.popup_post_logout_redirect_uri=i,this.popupWindowFeatures=n,this.popupWindowTarget=r,this.redirectMethod=s,this.redirectTarget=o,this.iframeNotifyParentOrigin=a,this.iframeScriptOrigin=c,this.silent_redirect_uri=d,this.silentRequestTimeoutInSeconds=l,this.automaticSilentRenew=u,this.validateSubOnSilentRenew=h,this.includeIdTokenInSilentRenew=g,this.monitorSession=p,this.monitorAnonymousSession=w,this.checkSessionIntervalInSeconds=m,this.stopCheckSessionOnError=_,this.query_status_response_type=f,this.revokeTokenTypes=v,this.revokeTokensOnSignout=y,this.includeIdTokenInSilentSignout=b,this.accessTokenExpiringNotificationTimeInSeconds=S,C)this.userStore=C;else{const e="undefined"!=typeof window?window.sessionStorage:new k;this.userStore=new P({store:e})}}},Y=class extends D{constructor({silentRequestTimeoutInSeconds:e=J}){super(),this._logger=new g("IFrameWindow"),this._timeoutInSeconds=e,this._frame=Y.createHiddenIframe(),this._window=this._frame.contentWindow}static createHiddenIframe(){const e=window.document.createElement("iframe");return e.style.visibility="hidden",e.style.position="fixed",e.style.left="-1000px",e.style.top="0",e.width="0",e.height="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),window.document.body.appendChild(e),e}async navigate(e){this._logger.debug("navigate: Using timeout of:",this._timeoutInSeconds);const t=setTimeout((()=>this._abort.raise(new b("IFrame timed out without a response"))),1e3*this._timeoutInSeconds);return this._disposeHandlers.add((()=>clearTimeout(t))),await super.navigate(e)}close(){var e;this._frame&&(this._frame.parentNode&&(this._frame.addEventListener("load",(e=>{var t;const i=e.target;null==(t=i.parentNode)||t.removeChild(i),this._abort.raise(new Error("IFrame removed from DOM"))}),!0),null==(e=this._frame.contentWindow)||e.location.replace("about:blank")),this._frame=null),this._window=null}static notifyParent(e,t){return super._notifyParent(window.parent,e,!1,t)}},X=class{constructor(e){this._settings=e,this._logger=new g("IFrameNavigator")}async prepare({silentRequestTimeoutInSeconds:e=this._settings.silentRequestTimeoutInSeconds}){return new Y({silentRequestTimeoutInSeconds:e})}async callback(e){this._logger.create("callback"),Y.notifyParent(e,this._settings.iframeNotifyParentOrigin)}},Z=class extends D{constructor({popupWindowTarget:e=K,popupWindowFeatures:t={}}){super(),this._logger=new g("PopupWindow");const i=f.center({...z,...t});this._window=window.open(void 0,e,f.serialize(i))}async navigate(e){var t;null==(t=this._window)||t.focus();const i=setInterval((()=>{this._window&&!this._window.closed||this._abort.raise(new Error("Popup closed by user"))}),500);return this._disposeHandlers.add((()=>clearInterval(i))),await super.navigate(e)}close(){this._window&&(this._window.closed||(this._window.close(),this._abort.raise(new Error("Popup closed")))),this._window=null}static notifyOpener(e,t){if(!window.opener)throw new Error("No window.opener. Can't complete notification.");return super._notifyParent(window.opener,e,t)}},ee=class{constructor(e){this._settings=e,this._logger=new g("PopupNavigator")}async prepare({popupWindowFeatures:e=this._settings.popupWindowFeatures,popupWindowTarget:t=this._settings.popupWindowTarget}){return new Z({popupWindowFeatures:e,popupWindowTarget:t})}async callback(e,t=!1){this._logger.create("callback"),Z.notifyOpener(e,t)}},te=class{constructor(e){this._settings=e,this._logger=new g("RedirectNavigator")}async prepare({redirectMethod:e=this._settings.redirectMethod,redirectTarget:t=this._settings.redirectTarget}){var i;this._logger.create("prepare");let n=window.self;"top"===t&&(n=null!=(i=window.top)?i:window.self);const r=n.location[e].bind(n.location);let s;return{navigate:async e=>{this._logger.create("navigate");const t=new Promise(((e,t)=>{s=t}));return r(e.url),await t},close:()=>{this._logger.create("close"),null==s||s(new Error("Redirect aborted")),n.stop()}}}},ie=class extends S{constructor(e){super({expiringNotificationTimeInSeconds:e.accessTokenExpiringNotificationTimeInSeconds}),this._logger=new g("UserManagerEvents"),this._userLoaded=new w("User loaded"),this._userUnloaded=new w("User unloaded"),this._silentRenewError=new w("Silent renew error"),this._userSignedIn=new w("User signed in"),this._userSignedOut=new w("User signed out"),this._userSessionChanged=new w("User session changed")}load(e,t=!0){super.load(e),t&&this._userLoaded.raise(e)}unload(){super.unload(),this._userUnloaded.raise()}addUserLoaded(e){return this._userLoaded.addHandler(e)}removeUserLoaded(e){return this._userLoaded.removeHandler(e)}addUserUnloaded(e){return this._userUnloaded.addHandler(e)}removeUserUnloaded(e){return this._userUnloaded.removeHandler(e)}addSilentRenewError(e){return this._silentRenewError.addHandler(e)}removeSilentRenewError(e){return this._silentRenewError.removeHandler(e)}_raiseSilentRenewError(e){this._silentRenewError.raise(e)}addUserSignedIn(e){return this._userSignedIn.addHandler(e)}removeUserSignedIn(e){this._userSignedIn.removeHandler(e)}_raiseUserSignedIn(){this._userSignedIn.raise()}addUserSignedOut(e){return this._userSignedOut.addHandler(e)}removeUserSignedOut(e){this._userSignedOut.removeHandler(e)}_raiseUserSignedOut(){this._userSignedOut.raise()}addUserSessionChanged(e){return this._userSessionChanged.addHandler(e)}removeUserSessionChanged(e){this._userSessionChanged.removeHandler(e)}_raiseUserSessionChanged(){this._userSessionChanged.raise()}},ne=class{constructor(e){this._userManager=e,this._logger=new g("SilentRenewService"),this._isStarted=!1,this._retryTimer=new _("Retry Silent Renew"),this._tokenExpiring=async()=>{const e=this._logger.create("_tokenExpiring");try{await this._userManager.signinSilent(),e.debug("silent token renewal successful")}catch(t){if(t instanceof b)return e.warn("ErrorTimeout from signinSilent:",t,"retry in 5s"),void this._retryTimer.init(5);e.error("Error from signinSilent:",t),this._userManager.events._raiseSilentRenewError(t)}}}async start(){const e=this._logger.create("start");if(!this._isStarted){this._isStarted=!0,this._userManager.events.addAccessTokenExpiring(this._tokenExpiring),this._retryTimer.addHandler(this._tokenExpiring);try{await this._userManager.getUser()}catch(t){e.error("getUser error",t)}}}stop(){this._isStarted&&(this._retryTimer.cancel(),this._retryTimer.removeHandler(this._tokenExpiring),this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring),this._isStarted=!1)}},re=class{constructor(e){this.refresh_token=e.refresh_token,this.id_token=e.id_token,this.session_state=e.session_state,this.scope=e.scope,this.profile=e.profile,this.data=e.state}},se=class{constructor(e){this._logger=new g("UserManager"),this.settings=new V(e),this._client=new F(e),this._redirectNavigator=new te(this.settings),this._popupNavigator=new ee(this.settings),this._iframeNavigator=new X(this.settings),this._events=new ie(this.settings),this._silentRenewService=new ne(this),this.settings.automaticSilentRenew&&this.startSilentRenew(),this._sessionMonitor=null,this.settings.monitorSession&&(this._sessionMonitor=new H(this))}get events(){return this._events}get metadataService(){return this._client.metadataService}async getUser(){const e=this._logger.create("getUser"),t=await this._loadUser();return t?(e.info("user loaded"),this._events.load(t,!1),t):(e.info("user not found in storage"),null)}async removeUser(){const e=this._logger.create("removeUser");await this.storeUser(null),e.info("user removed from storage"),this._events.unload()}async signinRedirect(e={}){this._logger.create("signinRedirect");const{redirectMethod:t,...i}=e,n=await this._redirectNavigator.prepare({redirectMethod:t});await this._signinStart({request_type:"si:r",...i},n)}async signinRedirectCallback(e=window.location.href){const t=this._logger.create("signinRedirectCallback"),i=await this._signinEnd(e);return i.profile&&i.profile.sub?t.info("success, signed in subject",i.profile.sub):t.info("no subject"),i}async signinResourceOwnerCredentials({username:e,password:t,skipUserInfo:i=!1}){const n=this._logger.create("signinResourceOwnerCredential"),r=await this._client.processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:i,extraTokenParams:this.settings.extraTokenParams});n.debug("got signin response");const s=await this._buildUser(r);return s.profile&&s.profile.sub?n.info("success, signed in subject",s.profile.sub):n.info("no subject"),s}async signinPopup(e={}){const t=this._logger.create("signinPopup"),{popupWindowFeatures:i,popupWindowTarget:n,...r}=e,s=this.settings.popup_redirect_uri;s||t.throw(new Error("No popup_redirect_uri configured"));const o=await this._popupNavigator.prepare({popupWindowFeatures:i,popupWindowTarget:n}),a=await this._signin({request_type:"si:p",redirect_uri:s,display:"popup",...r},o);return a&&(a.profile&&a.profile.sub?t.info("success, signed in subject",a.profile.sub):t.info("no subject")),a}async signinPopupCallback(e=window.location.href,t=!1){const i=this._logger.create("signinPopupCallback");await this._popupNavigator.callback(e,t),i.info("success")}async signinSilent(e={}){var t;const i=this._logger.create("signinSilent"),{silentRequestTimeoutInSeconds:n,...r}=e;let s=await this._loadUser();if(null==s?void 0:s.refresh_token){i.debug("using refresh token");const e=new re(s);return await this._useRefreshToken(e)}const o=this.settings.silent_redirect_uri;let a;o||i.throw(new Error("No silent_redirect_uri configured")),s&&this.settings.validateSubOnSilentRenew&&(i.debug("subject prior to silent renew:",s.profile.sub),a=s.profile.sub);const c=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:n});return s=await this._signin({request_type:"si:s",redirect_uri:o,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?null==s?void 0:s.id_token:void 0,...r},c,a),s&&((null==(t=s.profile)?void 0:t.sub)?i.info("success, signed in subject",s.profile.sub):i.info("no subject")),s}async _useRefreshToken(e){const t=await this._client.useRefreshToken({state:e,timeoutInSeconds:this.settings.silentRequestTimeoutInSeconds}),i=new $({...e,...t});return await this.storeUser(i),this._events.load(i),i}async signinSilentCallback(e=window.location.href){const t=this._logger.create("signinSilentCallback");await this._iframeNavigator.callback(e),t.info("success")}async signinCallback(e=window.location.href){const{state:t}=await this._client.readSigninResponseState(e);switch(t.request_type){case"si:r":return await this.signinRedirectCallback(e);case"si:p":return await this.signinPopupCallback(e);case"si:s":return await this.signinSilentCallback(e);default:throw new Error("invalid response_type in state")}}async signoutCallback(e=window.location.href,t=!1){const{state:i}=await this._client.readSignoutResponseState(e);if(i)switch(i.request_type){case"so:r":await this.signoutRedirectCallback(e);break;case"so:p":await this.signoutPopupCallback(e,t);break;case"so:s":await this.signoutSilentCallback(e);break;default:throw new Error("invalid response_type in state")}}async querySessionStatus(e={}){const t=this._logger.create("querySessionStatus"),{silentRequestTimeoutInSeconds:i,...n}=e,r=this.settings.silent_redirect_uri;r||t.throw(new Error("No silent_redirect_uri configured"));const s=await this._loadUser(),o=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:i}),a=await this._signinStart({request_type:"si:s",redirect_uri:r,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?null==s?void 0:s.id_token:void 0,response_type:this.settings.query_status_response_type,scope:"openid",skipUserInfo:!0,...n},o);try{const e=await this._client.processSigninResponse(a.url);return t.debug("got signin response"),e.session_state&&e.profile.sub?(t.info("success for subject",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid}):(t.info("success, user not authenticated"),null)}catch(e){if(this.settings.monitorAnonymousSession&&e instanceof y)switch(e.error){case"login_required":case"consent_required":case"interaction_required":case"account_selection_required":return t.info("success for anonymous user"),{session_state:e.session_state}}throw e}}async _signin(e,t,i){const n=await this._signinStart(e,t);return await this._signinEnd(n.url,i)}async _signinStart(e,t){const i=this._logger.create("_signinStart");try{const n=await this._client.createSigninRequest(e);return i.debug("got signin request"),await t.navigate({url:n.url,state:n.state.id,response_mode:n.state.response_mode,scriptOrigin:this.settings.iframeScriptOrigin})}catch(e){throw i.debug("error after preparing navigator, closing navigator window"),t.close(),e}}async _signinEnd(e,t){const i=this._logger.create("_signinEnd"),n=await this._client.processSigninResponse(e);return i.debug("got signin response"),await this._buildUser(n,t)}async _buildUser(e,t){const i=this._logger.create("_buildUser"),n=new $(e);if(t){if(t!==n.profile.sub)throw i.debug("current user does not match user returned from signin. sub from signin:",n.profile.sub),new y({...e,error:"login_required"});i.debug("current user matches user returned from signin")}return await this.storeUser(n),i.debug("user stored"),this._events.load(n),n}async signoutRedirect(e={}){const t=this._logger.create("signoutRedirect"),{redirectMethod:i,...n}=e,r=await this._redirectNavigator.prepare({redirectMethod:i});await this._signoutStart({request_type:"so:r",post_logout_redirect_uri:this.settings.post_logout_redirect_uri,...n},r),t.info("success")}async signoutRedirectCallback(e=window.location.href){const t=this._logger.create("signoutRedirectCallback"),i=await this._signoutEnd(e);return t.info("success"),i}async signoutPopup(e={}){const t=this._logger.create("signoutPopup"),{popupWindowFeatures:i,popupWindowTarget:n,...r}=e,s=this.settings.popup_post_logout_redirect_uri,o=await this._popupNavigator.prepare({popupWindowFeatures:i,popupWindowTarget:n});await this._signout({request_type:"so:p",post_logout_redirect_uri:s,state:null==s?void 0:{},...r},o),t.info("success")}async signoutPopupCallback(e=window.location.href,t=!1){const i=this._logger.create("signoutPopupCallback");await this._popupNavigator.callback(e,t),i.info("success")}async _signout(e,t){const i=await this._signoutStart(e,t);return await this._signoutEnd(i.url)}async _signoutStart(e={},t){var i;const n=this._logger.create("_signoutStart");try{const r=await this._loadUser();n.debug("loaded current user from storage"),this.settings.revokeTokensOnSignout&&await this._revokeInternal(r);const s=e.id_token_hint||r&&r.id_token;s&&(n.debug("setting id_token_hint in signout request"),e.id_token_hint=s),await this.removeUser(),n.debug("user removed, creating signout request");const o=await this._client.createSignoutRequest(e);return n.debug("got signout request"),await t.navigate({url:o.url,state:null==(i=o.state)?void 0:i.id})}catch(e){throw n.debug("error after preparing navigator, closing navigator window"),t.close(),e}}async _signoutEnd(e){const t=this._logger.create("_signoutEnd"),i=await this._client.processSignoutResponse(e);return t.debug("got signout response"),i}async signoutSilent(e={}){var t;const i=this._logger.create("signoutSilent"),{silentRequestTimeoutInSeconds:n,...r}=e,s=this.settings.includeIdTokenInSilentSignout?null==(t=await this._loadUser())?void 0:t.id_token:void 0,o=this.settings.popup_post_logout_redirect_uri,a=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:n});await this._signout({request_type:"so:s",post_logout_redirect_uri:o,id_token_hint:s,...r},a),i.info("success")}async signoutSilentCallback(e=window.location.href){const t=this._logger.create("signoutSilentCallback");await this._iframeNavigator.callback(e),t.info("success")}async revokeTokens(e){const t=await this._loadUser();await this._revokeInternal(t,e)}async _revokeInternal(e,t=this.settings.revokeTokenTypes){const i=this._logger.create("_revokeInternal");if(!e)return;const n=t.filter((t=>"string"==typeof e[t]));if(n.length){for(const t of n)await this._client.revokeToken(e[t],t),i.info(`${t} revoked successfully`),"access_token"!==t&&(e[t]=null);await this.storeUser(e),i.debug("user stored"),this._events.load(e)}else i.debug("no need to revoke due to no token(s)")}startSilentRenew(){this._logger.create("startSilentRenew"),this._silentRenewService.start()}stopSilentRenew(){this._silentRenewService.stop()}get _userStoreKey(){return`user:${this.settings.authority}:${this.settings.client_id}`}async _loadUser(){const e=this._logger.create("_loadUser"),t=await this.settings.userStore.get(this._userStoreKey);return t?(e.debug("user storageString loaded"),$.fromStorageString(t)):(e.debug("no user storageString"),null)}async storeUser(e){const t=this._logger.create("storeUser");if(e){t.debug("storing user");const i=e.toStorageString();await this.settings.userStore.set(this._userStoreKey,i)}else this._logger.debug("removing user"),await this.settings.userStore.remove(this._userStoreKey)}async clearStaleState(){await this._client.clearStaleState()}}}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={id:n,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nc=void 0,i(452),i(908),i(74),i(47)})();